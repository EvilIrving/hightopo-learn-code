!function(F,w,o){"use strict";var r=F.ht,A=r.Default,T=A.getInternal(),F=(A.clone,A.def),E=r.WebGLConstants,g=r.Math.Matrix4,S=r.Math.Vector3;function Z(F){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(F);for(var E="",t=0,a=F.length;t<a;t++)E+=String.fromCharCode(F[t]);try{return decodeURIComponent(escape(E))}catch(F){return E}}var K=new RegExp("[\\[\\]\\.:\\/]","g");function x(){this.userData={},this.matrix=new g,this.matrixWorld=new g,x.superClass.constructor.apply(this,arguments)}function J(F){for(var E in this.texture=!0,F)this[E]=F[E]}function f(F,E){this.mat=E,this.mesh=F,this.userData={},f.superClass.constructor.apply(this,arguments)}function j(){this.uuid=r.Math.generateUUID(),this.name="",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null}F(x,r.Data,{add:function(F){this.addChild(F)},traverse:function(F){A.traverse(this,F)},applyMatrix4:function(F){this.matrix.premultiply(F),this.getParent()?this.matrixWorld.multiplyMatrices(this.getParent().matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix)}});var q=function(){this.type="pbr",this.setValues=function(F){if(F){for(var E in F)this[E]=F[E];return this}},this.clone=function(){var F,E=new q;for(F in this)this[F]&&(E[F]=this[F]);return E}},t=(F(f,x,{normalizeSkinWeights:function(){var F=new r.Math.Vector4,E=this.mesh.attributes.skinWeight;if(E)for(var t=0,a=E.count;t<a;t++){F.fromBufferAttribute(E,t);var L=1/F.manhattanLength();L!=1/0?F.multiplyScalar(L):F.set(1,0,0,0),E.setXYZW(t,F.x,F.y,F.z,F.w)}}}),new r.Math.Matrix4);function $(F,E,t){this.name="",this.array=F,this.itemSize=E,this.count=F!==o?F.length/E:0,this.normalized=!0===t,this.usage=r.WebGLConstants.STATIC_DRAW,this.updateRange={offset:0,count:-1},this.version=0}F(j,w,{setIndex:function(F){return Array.isArray(F)?this.index=new(65535<arrayMax(F)?X:h)(F,1):this.index=F,this},setAttribute:function(F,E){return this.attributes[F]=E,this},deleteAttribute:function(F){return delete this.attributes[F],this},hasAttribute:function(F){return this.attributes[F]!==o},applyMatrix4:function(F){var E=this.attributes.position,E=(E!==o&&(E.applyMatrix4(F),E.needsUpdate=!0),this.attributes.normal),t=(E!==o&&(t=(new r.Math.Matrix3).getNormalMatrix(F),E.applyNormalMatrix(t),E.needsUpdate=!0),this.attributes.tangent);return t!==o&&(t.transformDirection(F),t.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},applyQuaternion:function(F){return t.makeRotationFromQuaternion(F),this.applyMatrix4(t),this},addGroup:function(F,E,t){this.groups.push({start:F,count:E,materialIndex:t||0})},setFromPoints:function(F){for(var E=[],t=0,a=F.length;t<a;t++){var L=F[t];E.push(L.x,L.y,L.z||0)}return this.setAttribute("position",new i(E,3)),this}}),w.defineProperty($.prototype,"needsUpdate",{set:function(F){!0===F&&this.version++}});var a=new S;function L(F,E,t){$.call(this,new Int8Array(F),E,t)}function P(F,E,t){$.call(this,new Uint8Array(F),E,t)}function e(F,E,t){$.call(this,new Uint8ClampedArray(F),E,t)}function d(F,E,t){$.call(this,new Int16Array(F),E,t)}function h(F,E,t){$.call(this,new Uint16Array(F),E,t)}function s(F,E,t){$.call(this,new Int32Array(F),E,t)}function X(F,E,t){$.call(this,new Uint32Array(F),E,t)}function i(F,E,t){$.call(this,new Float32Array(F),E,t)}function G(F,E,t){$.call(this,new Float64Array(F),E,t)}w.assign($.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(F){return this.usage=F,this},copy:function(F){return this.name=F.name,this.array=new F.array.constructor(F.array),this.itemSize=F.itemSize,this.count=F.count,this.normalized=F.normalized,this.usage=F.usage,this},copyAt:function(F,E,t){F*=this.itemSize,t*=E.itemSize;for(var a=0,L=this.itemSize;a<L;a++)this.array[F+a]=E.array[t+a];return this},copyArray:function(F){return this.array.set(F),this},copyColorsArray:function(F){for(var E=this.array,t=0,a=0,L=F.length;a<L;a++){var w=F[a];w===o?(E[t++]=1,E[t++]=1,E[t++]=1):(E[t++]=w.r,E[t++]=w.g,E[t++]=w.b)}return this},copyVector2sArray:function(F){for(var E=this.array,t=0,a=0,L=F.length;a<L;a++){var w=F[a];w===o&&(w=new Vector2),E[t++]=w.x,E[t++]=w.y}return this},copyVector3sArray:function(F){for(var E=this.array,t=0,a=0,L=F.length;a<L;a++){var w=F[a];w===o&&(w=new S),E[t++]=w.x,E[t++]=w.y,E[t++]=w.z}return this},copyVector4sArray:function(F){for(var E=this.array,t=0,a=0,L=F.length;a<L;a++){var w=F[a];w===o&&(w=new Vector4),E[t++]=w.x,E[t++]=w.y,E[t++]=w.z,E[t++]=w.w}return this},applyMatrix3:function(F){for(var E=0,t=this.count;E<t;E++)a.x=this.getX(E),a.y=this.getY(E),a.z=this.getZ(E),a.applyMatrix3(F),this.setXYZ(E,a.x,a.y,a.z);return this},applyMatrix4:function(F){for(var E=0,t=this.count;E<t;E++)a.x=this.getX(E),a.y=this.getY(E),a.z=this.getZ(E),a.applyMatrix4(F),this.setXYZ(E,a.x,a.y,a.z);return this},applyNormalMatrix:function(F){for(var E=0,t=this.count;E<t;E++)a.x=this.getX(E),a.y=this.getY(E),a.z=this.getZ(E),a.applyNormalMatrix(F),this.setXYZ(E,a.x,a.y,a.z);return this},transformDirection:function(F){for(var E=0,t=this.count;E<t;E++)a.x=this.getX(E),a.y=this.getY(E),a.z=this.getZ(E),a.transformDirection(F),this.setXYZ(E,a.x,a.y,a.z);return this},set:function(F,E){return this.array.set(F,E=E===o?0:E),this},getX:function(F){return this.array[F*this.itemSize]},setX:function(F,E){return this.array[F*this.itemSize]=E,this},getY:function(F){return this.array[F*this.itemSize+1]},setY:function(F,E){return this.array[F*this.itemSize+1]=E,this},getZ:function(F){return this.array[F*this.itemSize+2]},setZ:function(F,E){return this.array[F*this.itemSize+2]=E,this},getW:function(F){return this.array[F*this.itemSize+3]},setW:function(F,E){return this.array[F*this.itemSize+3]=E,this},setXY:function(F,E,t){return F*=this.itemSize,this.array[F+0]=E,this.array[F+1]=t,this},setXYZ:function(F,E,t,a){return F*=this.itemSize,this.array[F+0]=E,this.array[F+1]=t,this.array[F+2]=a,this},setXYZW:function(F,E,t,a,L){return F*=this.itemSize,this.array[F+0]=E,this.array[F+1]=t,this.array[F+2]=a,this.array[F+3]=L,this},onUpload:function(F){return this.onUploadCallback=F,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),(L.prototype=w.create($.prototype)).constructor=L,(P.prototype=w.create($.prototype)).constructor=P,(e.prototype=w.create($.prototype)).constructor=e,(d.prototype=w.create($.prototype)).constructor=d,h.prototype=w.create($.prototype),h.prototype.constructor=h,(s.prototype=w.create($.prototype)).constructor=s,X.prototype=w.create($.prototype),X.prototype.constructor=X,(i.prototype=w.create($.prototype)).constructor=i,(G.prototype=w.create($.prototype)).constructor=G;function _(F,q,h){var Z=r.Math.generateUUID();A.addPendingPlaceholder(Z),new C(q).parse(F,"",function(F){var E,a,L,t={model3d:!0,matDef:{}},w=F.scene,P=(b(t,w,q,{},t.matDef),F.animations),P=(P&&(t.animations=P),F.assets),e=(P&&(t.assets=P),{}),d={};A.traverse(t,null,function(F){if(e[F.name]){for(F.displayName=F.name;E=F.name+"_"+r.Math.generateIncreasingID(),e[E];);F.name=E}e[F.name]=F.ID,d[F.ID]=F.name,delete F.ID},"comps"),t.animations&&t.animations.forEach(function(F){F.tracks.forEach(function(F){var E=F.name.split(".");E[0]&&d[E[0]]&&(F.name=d[E[0]]+"."+E.slice(1).join("."))})}),A.traverse(t,null,function(F){var E=F.skeleton;if(E){for(var t=E[0],a=t.length,L=new Array(a),w=0;w<a;w++)L[w]=t[w].name;F.skeleton={bones:L,boneMatrixInverses:E[1],bindMatrix:E[2].toArray(),bindMatrixInverse:(new g).copy(E[2]).invert().toArray()}}},"comps"),A.traverse(t,null,function(F){var E=F.comps;if(E)for(var t=E.length-1;0<=t;t--){var a=E[t];a.mesh||a.isBone||a.comps&&a.comps.length||E.splice(t,1)}},"comps"),(q.center||q.cube)&&(a=new r.Math.Box3,L=new r.Math.Box3,A.traverse(w,function(F,E){var t=F.mesh;F._matrixWorldNeedUpdate&&(E&&F._matrixWorld.premultiply(E._matrixWorld),delete F._matrixWorldNeedUpdate),t&&t.attributes&&t.attributes.position&&(L.setFromArray(t.attributes.position.array),L.applyMatrix4(F._matrixWorld),a.expandByBox(L))},null,"_children"),T.completeCubeCenterOfModel3d(t,a,q.cube,q.center));q.flipY&&A.traverse(t,function(F){F=F.mesh;if(F&&(F.uv||F.uv2)){for(var E=1,t=F.uv,a=t?t.length:0;E<a;E+=2)t[E]=1-t[E];for(E=1,a=(t=F.uv2)?t.length:0;E<a;E+=2)t[E]=1-t[E]}},null,"comps");var J=q.matDef;if(J)if(t.matDef)for(var j in J)t.matDef[j]=J[j];else t.matDef=J;q.shape3d&&A.setShape3dModel(q.shape3d,t),q.playAutomatically&&(t.playAutomatically=!0),F.externalAssetURIs&&(t.externalAssetURIs=F.externalAssetURIs),h&&h(t),A.removePendingPlaceholder(Z,t)},function(F){console.error(F),h&&h(null),A.removePendingPlaceholder(Z,null)})}var V={5:"triangleStrip",6:"triangleFan",1:"lines",2:"lineLoop",3:"lineStrip"},c=(V[E.POINTS]="points",{position:"vs",normal:"ns"}),D=new g,R=r.Math.newIdGenerator(),b=function(F,E,t,a,L){var w=E.mat;if(w){var P=L[w.name||(w.name="material_"+R.next())]={};for(J in w)"name"!==J&&"setValues"!==J&&"clone"!==J&&(P[J]=w[J]);F.mat=w.name}var e=E.mesh;if(e){F.mesh=d={},e.index&&(d.is=e.index.array);var d,J,j=e.attributes;for(J in j)d[c[J]||J]=j[J].array}E.matrix&&!E.matrix.equals(D)?decomposeTRS(F,E.matrix):(E.position&&(F.position=E.position),(E.rotation||E.quaternion)&&(F.quaternion=E.rotation||E.quaternion),E.scale&&(F.scale=E.scale)),E.userData&&(e=E.userData.transformData)&&(e.rotationOffset||e.rotationPivot||e.scalingOffset||e.scalingPivot)&&((Z=F.transformData={}).translation=e.translation||[0,0,0],e.rotation?((h=e.rotation.map(degToRad)).push(e.eulerOrder),Z.rotation=h):Z.rotation=[0,0,0,1],Z.scale=e.scale||[1,1,1],copyIfExists(Z,e,"rotationOffset"),copyIfExists(Z,e,"rotationPivot"),copyIfExists(Z,e,"scalingOffset"),copyIfExists(Z,e,"scalingPivot")),E._matrixWorld=(new g).composeFromArray(F.position,F.quaternion,F.scale),E._matrixWorldNeedUpdate=!0;E.isBone&&(F.isBone=!0),F.name=E.name,F.ID=E.ID;var q,h=E.skeleton,Z=(h&&(F.skeleton=h),E.animations),A=(Z&&(F.animations=Z),E.getChildren().getArray());if(A){F.comps=[];for(var T=0,x=A.length;T<x;T++)F.comps.push(q={}),b(q,A[T],t,a,L)}},C=(T.addMethod(A,{loadGltf:function(a,L){if(!(L=L||{}).path)for(var F=a.length-1;0<=F;F--){var E=a.charAt(F);if("/"===E||"\\"===E){L.path=a.substring(0,F+1);break}}L.responseType="arraybuffer",A.xhrLoad(a,function(F){var t;F=F,t=L.finishFunc,F||t(null),_(F,L,function(F){var E=L.shape3d;F?t&&t(F,a,E):t&&t(null)})},L)},parseGltf:_}),function(F){F=F||{},this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.assetsURIMap=F.assetsURIMap,this.path=F.path||"",this.register(function(F){return new p(F)}),this.register(function(F){return new H(F)}),this.register(function(F){return new U(F)}),this.register(function(F){return new M(F)}),this.register(function(F){return new k(F)}),this.register(function(F){return new u(F)}),this.register(function(F){return new I(F)}),this.register(function(F){return new m(F)}),this.register(function(F){return new N(F)}),this.register(function(F){return new Fv(F)})});function B(){var t={};return{get:function(F){return t[F]},add:function(F,E){t[F]=E},remove:function(F){delete t[F]},removeAll:function(){t={}}}}F(C,w,{getDRACOLoader:function(){var F=this.dracoLoader;return F||(F=(new xv).setDecoderPath(A.dracoLibraryPath||""),this.setDRACOLoader(F),F)},setDRACOLoader:function(F){return this.dracoLoader=F,this},setDDSLoader:function(){throw new Error('GLTFLoader: use "KHR_texture_basisu" instead.')},setKTX2Loader:function(F){return this.ktx2Loader=F,this},setMeshoptDecoder:function(F){return this.meshoptDecoder=F,this},register:function(F){return-1===this.pluginCallbacks.indexOf(F)&&this.pluginCallbacks.push(F),this},unregister:function(F){return-1!==this.pluginCallbacks.indexOf(F)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(F),1),this},parse:function(F,E,t,a){var L,w={},P={};if("string"==typeof F)L=F;else if(Z(new Uint8Array(F,0,4))===Ev){try{w[y.KHR_BINARY_GLTF]=new Lv(F)}catch(F){return void(a&&a(F))}L=w[y.KHR_BINARY_GLTF].content}else L=Z(new Uint8Array(F));var e=JSON.parse(L);if(e.asset===o||e.asset.version[0]<2)a&&a(new Error("GLTFLoader: only glTF versions >=2.0 are supported."));else{for(var d=new Av(e,{assetsURIMap:this.assetsURIMap,path:E||this.resourcePath||this.path||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder}),J=0;J<this.pluginCallbacks.length;J++){var j=this.pluginCallbacks[J](d);w[(P[j.name]=j).name]=!0}if(e.extensionsUsed)for(J=0;J<e.extensionsUsed.length;++J){var q=e.extensionsUsed[J],h=e.extensionsRequired||[];switch(q){case y.KHR_MATERIALS_UNLIT:w[q]=new O;break;case y.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:w[q]=new GLTFMaterialsPbrSpecularGlossinessExtension;break;case y.KHR_DRACO_MESH_COMPRESSION:w[q]=new wv(e,this.getDRACOLoader());break;case y.KHR_TEXTURE_TRANSFORM:w[q]=new Pv;break;case y.KHR_MESH_QUANTIZATION:w[q]=new ev;break;default:0<=h.indexOf(q)&&P[q]===o&&console.warn('GLTFLoader: Unknown extension "'+q+'".')}}d.setExtensions(w),d.setPlugins(P),d.parse(t,a)}},parseAsync:function(t,a){var L=this;return new Promise(function(F,E){L.parse(t,a,F,E)})}});var y={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"},N=function(F){this.parser=F,this.name=y.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}},O=(F(N,w,{_markDefs:function(){},createNodeAttachment:function(){return null}}),function(){this.name=y.KHR_MATERIALS_UNLIT}),m=(F(O,w,{getMaterialType:function(){return Q},extendParams:function(F,E,t){var a,L=[],E=(F.diffuse=[1,1,1],F.opacity=1,E.pbrMetallicRoughness);return E&&(Array.isArray(E.baseColorFactor)&&(a=E.baseColorFactor,F.diffuse=a,F.opacity=a[3]),E.baseColorTexture!==o&&L.push(t.assignTexture(F,"map",E.baseColorTexture))),Promise.all(L)}}),function(F){this.parser=F,this.name=y.KHR_MATERIALS_SPECULAR}),E=(F(m,w,{getMaterialType:function(F){F=this.parser.json.materials[F];return F.extensions&&F.extensions[this.name]?Q:null},extendParams:function(F,E,t){if(!(E=(t=this.parser).json.materials[materialIndex]).extensions||!E.extensions[this.name])return Promise.resolve();var a=[],E=E.extensions[this.name],L=(F.specularIntensity=E.specularFactor!==o?E.specularFactor:1,E.specularTexture!==o&&a.push(t.assignTexture(F,"specularIntensityMap",E.specularTexture)),E.specularColorFactor||[1,1,1]);return F.specularColor=[L[0],L[1],L[2]],E.specularColorTexture!==o&&a.push(t.assignTexture(F,"specularColorMap",E.specularColorTexture)),Promise.all(a)}}),{getMaterialType:function(F){F=this.parser.json.materials[F];return F.extensions&&F.extensions[this.name]?Q:null},extendParams:function(){return Promise.resolve()}}),p=function(F){this.parser=F,this.name=y.KHR_MATERIALS_CLEARCOAT},M=(F(p,w,E),function(F){this.parser=F,this.name=y.KHR_MATERIALS_SHEEN}),k=(F(M,w,E),function(F){this.parser=F,this.name=y.KHR_MATERIALS_TRANSMISSION}),u=(F(k,w,E),function(F){this.parser=F,this.name=y.KHR_MATERIALS_VOLUME}),I=(F(u,w,E),function(F){this.parser=F,this.name=y.KHR_MATERIALS_IOR}),H=(F(I,w,E),function(F){this.parser=F,this.name=y.KHR_TEXTURE_BASISU}),U=(F(H,w,{loadTexture:function(F){var E=this.parser,t=E.json,a=t.textures[F];if(!a.extensions||!a.extensions[this.name])return null;var a=a.extensions[this.name],L=E.options.ktx2Loader;if(L)return E.loadTextureImage(F,a.source,L);if(t.extensionsRequired&&0<=t.extensionsRequired.indexOf(this.name))throw new Error("GLTFLoader: setKTX2Loader must be called");return null}}),function(F){this.parser=F,this.name=y.EXT_TEXTURE_WEBP,this.isSupported=null}),Fv=(F(U,w,{loadTexture:function(E){var t=this.name,a=this.parser,L=a.json,F=L.textures[E];if(!F.extensions||!F.extensions[t])return null;var F=F.extensions[t],w=L.images[F.source],P=a.textureLoader;return this.detectSupport().then(function(F){if(F)return a.loadTextureImage(E,w,P);if(L.extensionsRequired&&0<=L.extensionsRequired.indexOf(t))throw new Error("GLTFLoader: WebP required by asset but unsupported.");return a.loadTexture(E)})},detectSupport:function(){return this.isSupported||(this.isSupported=new Promise(function(F){var E=new Image;E.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",E.onload=E.onerror=function(){F(1===E.height)}})),this.isSupported}}),function(F){this.parser=F,this.name=y.EXT_MESHOPT_COMPRESSION}),Ev=(F(Fv,w,{loadBufferView:function(F){var E=this.parser.json,F=E.bufferViews[F];if(F.extensions&&F.extensions[this.name]){var P=F.extensions[this.name],F=this.parser.getDependency("buffer",P.buffer),e=this.parser.options.meshoptDecoder;if(e&&e.supported)return Promise.all([F,e.ready]).then(function(F){var E=P.byteOffset||0,t=P.byteLength||0,a=P.count,L=P.byteStride,w=new ArrayBuffer(a*L),F=new Uint8Array(F[0],E,t);return e.decodeGltfBuffer(new Uint8Array(w),a,L,F,P.mode,P.filter),w});if(E.extensionsRequired&&0<=E.extensionsRequired.indexOf(this.name))throw new Error("GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return null}}),"glTF"),tv=1313821514,av=5130562,Lv=function(F){this.name=y.KHR_BINARY_GLTF,this.content=null,this.body=null;var E=new DataView(F,0,12);if(this.header={magic:Z(new Uint8Array(F.slice(0,4))),version:E.getUint32(4,!0),length:E.getUint32(8,!0)},this.header.magic!==Ev)throw new Error("GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("GLTFLoader: Legacy binary file detected.");for(var t=this.header.length-12,a=new DataView(F,12),L=0;L<t;){var w,P=a.getUint32(L,!0),e=(L+=4,a.getUint32(L,!0));L+=4,e===tv?(w=new Uint8Array(F,12+L,P),this.content=Z(w)):e===av&&(this.body=F.slice(w=12+L,w+P)),L+=P}if(null===this.content)throw new Error("GLTFLoader: JSON content not found.")},wv=function(F,E){if(!E)throw new Error("GLTFLoader: No DRACOLoader instance provided.");this.name=y.KHR_DRACO_MESH_COMPRESSION,this.json=F,this.dracoLoader=E,this.dracoLoader.preload()},Pv=(F(wv,w,{decodePrimitive:function(F,E){var t,a=this.json,L=this.dracoLoader,w=F.extensions[this.name].bufferView,P=F.extensions[this.name].attributes,e={},d={},J={};for(t in P){var j=v[t]||t.toLowerCase();e[j]=P[t]}for(t in F.attributes){var q,h,j=v[t]||t.toLowerCase();P[t]!==o&&(q=a.accessors[F.attributes[t]],h=l[q.componentType],J[j]=h.name,d[j]=!0===q.normalized)}return E.getDependency("bufferView",w).then(function(F){return new Promise(function(a){L.decodeDracoFile(F,function(F){for(var E in F.attributes){var t=F.attributes[E],E=d[E];E!==o&&(t.normalized=E)}a(F)},e,J)})})}}),function(){this.name=y.KHR_TEXTURE_TRANSFORM}),ev=(F(Pv,w,{extendTexture:function(F,E){console.log("extend texture is not supported.")}}),function(){this.name=y.KHR_MESH_QUANTIZATION}),l={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},dv={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},v={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Jv={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},jv="OPAQUE",qv="MASK",hv="BLEND",Q=function(F){var E=(new q).setValues({type:"pbr"});return F&&E.setValues(F),E};function Y(F,E,t){for(var a in t.extensions)F[a]===o&&(E.userData.gltfExtensions=E.userData.gltfExtensions||{},E.userData.gltfExtensions[a]=t.extensions[a])}function W(F,E){var t,E=E.extras;E!==o&&("object"==typeof E?((t=F.userData)||(F.userData=t={}),w.assign(t,E)):console.warn("GLTFLoader: Ignoring primitive type .extras, "+E))}function Zv(F){for(var E="",t=w.keys(F).sort(),a=0,L=t.length;a<L;a++)E+=t[a]+":"+F[t[a]]+";";return E}function n(F){switch(F){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("GLTFLoader: Unsupported normalized accessor component type.")}}var Av=function(F,E){E=E||{},this.json=F=F||{},this.extensions={},this.plugins={},this.options=E,this.cache=new B,this.associations=new Map,this.primitiveCache={},this.assetsURIMap=E.assetsURIMap,this.path=E.path,this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={},this.assets=[],this.externalAssetURIs=[],this.nameIdGenerator=r.Math.newIdGenerator()};function Tv(t,F,a){var E,L=F.attributes,w=[];for(E in L){var P=v[E]||E.toLowerCase();P in t.attributes||w.push(function(F,E){return a.getDependency("accessor",F).then(function(F){t.setAttribute(E,F)})}(L[E],P))}F.indices===o||t.index||(e=a.getDependency("accessor",F.indices).then(function(F){t.setIndex(F)}),w.push(e)),W(t,F);var e=t,d=F,J=a,j=d.attributes,q=new r.Math.Box3;if(j.POSITION!==o){var h=(s=J.json.accessors[j.POSITION]).min,Z=s.max;if(h===o||Z===o)console.warn("GLTFLoader: Missing min/max properties for accessor POSITION.");else{q.set(new S(h[0],h[1],h[2]),new S(Z[0],Z[1],Z[2])),s.normalized&&(X=n(l[s.componentType]),q.min.multiplyScalar(X),q.max.multiplyScalar(X));var A=d.targets;if(A!==o){for(var T=new S,x=new S,g=0,f=A.length;g<f;g++){var s,X,$=A[g];$.POSITION!==o&&(h=(s=J.json.accessors[$.POSITION]).min,Z=s.max,h!==o&&Z!==o?(x.setX(Math.max(Math.abs(h[0]),Math.abs(Z[0]))),x.setY(Math.max(Math.abs(h[1]),Math.abs(Z[1]))),x.setZ(Math.max(Math.abs(h[2]),Math.abs(Z[2]))),s.normalized&&(X=n(l[s.componentType]),x.multiplyScalar(X)),T.max(x)):console.warn("GLTFLoader: Missing min/max properties for accessor POSITION."))}q.expandByVector(T)}e.boundingBox=q;j=new r.Math.Sphere;q.getCenter(j.center),j.radius=q.min.distanceTo(q.max)/2,e.boundingSphere=j}}return Promise.all(w).then(function(){return F.targets!==o?addMorphTargets(t,F.targets,a):t})}F(Av,w,{setExtensions:function(F){this.extensions=F},setPlugins:function(F){this.plugins=F},parse:function(t,F){var a=this,L=this.json,w=this.extensions,P=this.assets;this.cache.removeAll(),this._invokeAll(function(F){return F._markDefs&&F._markDefs()}),Promise.all(this._invokeAll(function(F){return F.beforeRoot&&F.beforeRoot()})).then(function(){return Promise.all([a.getDependencies("scene"),a.getDependencies("animation")])}).then(function(F){var E={scene:F[0][L.scene||0],scenes:F[0],animations:F[1],cameras:F[2],asset:L.asset,parser:a,userData:{},externalAssetURIs:a.externalAssetURIs};P.length&&(E.assets=P),Y(w,E,L),W(E,L),Promise.all(a._invokeAll(function(F){return F.afterRoot&&F.afterRoot(E)})).then(function(){t(E)})}).catch(F)},_markDefs:function(){for(var F=this.json.nodes||[],E=this.json.skins||[],t=this.json.meshes||[],a=0,L=E.length;a<L;a++)for(var w=E[a].joints,P=0,e=w.length;P<e;P++)F[w[P]].isBone=!0;for(var d=0,J=F.length;d<J;d++){var j=F[d];j.mesh!==o&&(this._addNodeRef(this.meshCache,j.mesh),j.skin!==o&&(t[j.mesh].isSkinnedMesh=!0)),j.camera!==o&&this._addNodeRef(this.cameraCache,j.camera)}},_addNodeRef:function(F,E){E!==o&&(F.refs[E]===o&&(F.refs[E]=F.uses[E]=0),F.refs[E]++)},_getNodeRef:function(F,E,t){if(F.refs[E]<=1)return t;var a,L,w=new f(t.geometry,t.material);for(a in t)"geometry"!==a&&"material"!==a&&"_id"!==a&&(L=t[a],w[a]=L&&L.clone?L.clone():L);var P=this,e=function(F,E){var t=P.associations.get(F);null!=t&&P.associations.set(E,t);for(var a=0,t=F.children,L=t?t.length:0;a<L;a++)e(F.children[a],E.children[a])};return e(t,w),w.name+="_instance_"+F.uses[E]++,w},_invokeOne:function(F){var E=w.values(this.plugins);E.push(this);for(var t=0;t<E.length;t++){var a=F(E[t]);if(a)return a}return null},_invokeAll:function(F){for(var E=w.values(this.plugins),t=(E.unshift(this),[]),a=0;a<E.length;a++){var L=F(E[a]);L&&t.push(L)}return t},getDependency:function(F,E){var t=F+":"+E,a=this.cache.get(t);if(!a){switch(F){case"scene":a=this.loadScene(E);break;case"node":a=this.loadNode(E);break;case"mesh":a=this._invokeOne(function(F){return F.loadMesh&&F.loadMesh(E)});break;case"accessor":a=this.loadAccessor(E);break;case"bufferView":a=this._invokeOne(function(F){return F.loadBufferView&&F.loadBufferView(E)});break;case"buffer":a=this.loadBuffer(E);break;case"material":a=this._invokeOne(function(F){return F.loadMaterial&&F.loadMaterial(E)});break;case"texture":a=this._invokeOne(function(F){return F.loadTexture&&F.loadTexture(E)});break;case"skin":a=this.loadSkin(E);break;case"animation":a=this.loadAnimation(E);break;case"camera":a=this.loadCamera(E);break;default:throw new Error("Unknown type: "+F)}this.cache.add(t,a)}return a},getDependencies:function(t){var a,F,E=this.cache.get(t);return E||(F=(a=this).json[t+("mesh"===t?"es":"s")]||[],E=Promise.all(F.map(function(F,E){return a.getDependency(t,E)})),this.cache.add(t,E)),E},loadBuffer:function(F){var a=this.json.buffers[F];if(a.type&&"arraybuffer"!==a.type)throw new Error("GLTFLoader: "+a.type+" buffer type is not supported.");if(a.uri===o&&0===F)return Promise.resolve(this.extensions[y.KHR_BINARY_GLTF].body);var L=this.path,w=this.assets,P=this.externalAssetURIs,e=this.assetsURIMap;return new Promise(function(E,t){var F=a.uri;a.uri.indexOf("data:")<0&&(P.indexOf(F)<0&&P.push(F),F=e&&e[F]?e[F]:L+F,w.push(F)),r.Default.xhrLoad(F,function(F){F?E(F):t(new Error('GLTFLoader: Failed to load buffer "'+a.uri+'".'))},{responseType:"arraybuffer"})})},loadBufferView:function(F){var a=this.json.bufferViews[F];return this.getDependency("buffer",a.buffer).then(function(F){var E=a.byteLength||0,t=a.byteOffset||0;return F.slice(t,t+E)})},loadAccessor:function(F){var s=this.json,X=this.json.accessors[F];if(X.bufferView===o&&X.sparse===o)return Promise.resolve(null);F=[];return X.bufferView!==o?F.push(this.getDependency("bufferView",X.bufferView)):F.push(null),X.sparse!==o&&(F.push(this.getDependency("bufferView",X.sparse.indices.bufferView)),F.push(this.getDependency("bufferView",X.sparse.values.bufferView))),Promise.all(F).then(function(F){var E,t=F[0],a=dv[X.type],L=l[X.componentType],w=L.BYTES_PER_ELEMENT,P=X.byteOffset||0,e=X.bufferView!==o?s.bufferViews[X.bufferView].byteStride:o,d=!0===X.normalized;if(e&&e!==w*a){for(var J=new L(X.count*a),j=Math.round(e/w),q=P%e/w,h=new L(t,Math.floor(P/e)*e,X.count*e/w),Z=0;Z<X.count;Z++)for(var A=0;A<a;A++){var T=Z*j+A+q;J[Z*a+A]=h[T]}E=new $(J,a,d)}else E=new $(J=null===t?new L(X.count*a):new L(t,P,X.count*a),a,d);if(X.sparse!==o){var e=l[X.sparse.indices.componentType],w=X.sparse.indices.byteOffset||0,P=X.sparse.values.byteOffset||0,x=new e(F[1],w,X.sparse.count*dv.SCALAR),g=new L(F[2],P,X.sparse.count*a);null!==t&&(E=new $(E.array.slice(),E.itemSize,E.normalized));for(var Z=0,f=x.length;Z<f;Z++){T=x[Z];if(E.setX(T,g[Z*a]),2<=a&&E.setY(T,g[Z*a+1]),3<=a&&E.setZ(T,g[Z*a+2]),4<=a&&E.setW(T,g[Z*a+3]),5<=a)throw new Error("GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return E})},loadTexture:function(F){var E=this.json.textures[F].source,t=this.textureLoader;return this.loadTextureImage(F,E,t)},loadTextureImage:function(t,F,E){var a=this,L=this.json,w=L.textures[t],P=L.images[F],P=(P.uri||P.bufferView)+":"+w.sampler;if(this.textureCache[P])return this.textureCache[P];F=this.loadImageSource(F,E).then(function(F){F.flipY=!1,w.name&&(F.name=w.name);var E=(L.samplers||{})[w.sampler]||{};return E.magFilter!==o&&(F.magFilter=E.magFilter),E.minFilter!==o&&(F.minFilter=E.minFilter),E.wrapS!==o&&(F.wrapS=E.wrapS),E.wrapT!==o&&(F.wrapT=E.wrapT),a.associations.set(F,{textures:t}),F}).catch(function(){return null});return this.textureCache[P]=F},loadImageSource:function(F,E){var t=this.json;if(this.sourceCache[F]!==o)return this.sourceCache[F].then(function(F){F.clone()});var a=t.images[F],L=self.URL||self.webkitURL,w="string"==typeof(w=a.uri)&&w.indexOf("data:")<0?((t=this.externalAssetURIs).indexOf(w)<0&&t.push(w),this.assetsURIMap&&this.assetsURIMap[w]?this.assetsURIMap[w]:this.path+w):w||"",P=!1;if(a.bufferView!==o)w=this.getDependency("bufferView",a.bufferView).then(function(F){P=!0;F=new Blob([F],{type:a.mimeType});return w=L.createObjectURL(F)});else if(a.uri===o)throw new Error("GLTFLoader: Image "+F+" is missing URI and bufferView");t=Promise.resolve(w).then(function(L){return new Promise(function(F,E){var t,a=decodeURIComponent(L);P?((t=new Image).src=a,t.onload=function(){F(new J({image:t}))}):F(new J({image:a}))})}).then(function(F){return!0===P&&L.revokeObjectURL(w),F}).catch(function(F){throw console.error("GLTFLoader: Couldn't load texture",w),F});return this.sourceCache[F]=t},assignTexture:function(a,L,w){var P=this;return this.getDependency("texture",w.index).then(function(F){var E,t;return w.texCoord===o||0==w.texCoord||"aoMap"===L&&1==w.texCoord||console.warn("GLTFLoader: Custom UV set "+w.texCoord+" for texture "+L+" not yet supported."),P.extensions[y.KHR_TEXTURE_TRANSFORM]&&(E=w.extensions!==o?w.extensions[y.KHR_TEXTURE_TRANSFORM]:o)&&(t=P.associations.get(F),F=P.extensions[y.KHR_TEXTURE_TRANSFORM].extendTexture(F,E),P.associations.set(F,t)),a[L]=F})},assignFinalMaterial:function(F){var E,t,a=F.mesh,L=F.mat,w=a.attributes.tangent===o,P=a.attributes.color!==o,e=a.attributes.normal===o;(w||P||e)&&(E="ClonedMaterial:"+L.uuid+":",L.isGLTFSpecularGlossinessMaterial&&(E+="specular-glossiness:"),w&&(E+="derivative-tangents:"),P&&(E+="vertex-colors:"),e&&(E+="flat-shading:"),(t=this.cache.get(E))||(t=L.clone(),P&&(t.vertexColors=!0),e&&(t.flatShading=!0),w&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(E,t),this.associations.set(t,this.associations.get(L))),L=t),L.aoMap&&a.attributes.uv2===o&&a.attributes.uv!==o&&a.setAttribute("uv2",a.attributes.uv),F.material=L},getMaterialType:function(){return Q},loadMaterial:function(E){var t,a=this,F=this.json,L=this.extensions,w=F.materials[E],P={},F=w.extensions||{},e=[],d=(F[y.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]?(d=L[y.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS],t=d.getMaterialType(),e.push(d.extendParams(P,w,a))):F[y.KHR_MATERIALS_UNLIT]?(d=L[y.KHR_MATERIALS_UNLIT],t=d.getMaterialType(),e.push(d.extendParams(P,w,a))):(F=w.pbrMetallicRoughness||{},P.diffuse=[1,1,1],P.opacity=1,Array.isArray(F.baseColorFactor)&&(d=F.baseColorFactor,P.diffuse=d,P.opacity=d[3]),F.baseColorTexture!==o&&e.push(a.assignTexture(P,"map",F.baseColorTexture)),P.metalness=F.metallicFactor!==o?F.metallicFactor:1,P.roughness=F.roughnessFactor!==o?F.roughnessFactor:1,F.metallicRoughnessTexture!==o&&(e.push(a.assignTexture(P,"metalnessMap",F.metallicRoughnessTexture)),e.push(a.assignTexture(P,"roughnessMap",F.metallicRoughnessTexture))),t=this._invokeOne(function(F){return F.getMaterialType&&F.getMaterialType(E)}),e.push(Promise.all(this._invokeAll(function(F){return F.extendMaterialParams&&F.extendMaterialParams(E,P)})))),!0===w.doubleSided&&(P.cullFace=!1),w.alphaMode||jv);return d===hv?(P.transparent=!0,P.depthWrite=!1):(P.transparent=!1,d===qv&&(P.alphaTest=w.alphaCutoff!==o?w.alphaCutoff:.5)),w.normalTexture!==o&&(e.push(a.assignTexture(P,"normalMap",w.normalTexture)),P.normalScale=[1,1],w.normalTexture.scale!==o&&(F=w.normalTexture.scale,P.normalScale=[F,F])),w.occlusionTexture!==o&&(e.push(a.assignTexture(P,"aoMap",w.occlusionTexture)),w.occlusionTexture.strength!==o&&(P.aoMapIntensity=w.occlusionTexture.strength)),w.emissiveFactor!==o&&(P.emissive=w.emissiveFactor),w.emissiveTexture!==o&&e.push(a.assignTexture(P,"emissiveMap",w.emissiveTexture)),Promise.all(e).then(function(){var F=(new t).setValues(P);return w.name&&(F.name=w.name),W(F,w),a.associations.set(F,{materials:E}),w.extensions&&Y(L,F,w),F.roughnessMap&&(F.roughnessChannel="G"),F.metalnessMap&&(F.metalnessChannel="B"),F.aoMap&&(F.aoChannel="R",F.aoUvChannel=2),F})},createUniqueName:function(F){for(var E=(F||"").replace(/\s/g,"_").replace(K,""),t=E,a=1;this.nodeNamesUsed[t];++a)t=E+"_"+a;return this.nodeNamesUsed[t]=!0,t},loadGeometries:function(F){var t=this,a=this.extensions,E=this.primitiveCache;for(var L=[],w=0,P=F.length;w<P;w++){var e=F[w],d=(J=void 0,J=(J=(d=e).extensions&&d.extensions[y.KHR_DRACO_MESH_COMPRESSION])?"draco:"+J.bufferView+":"+J.indices+":"+Zv(J.attributes):d.indices+":"+Zv(d.attributes)+":"+d.mode),J=E[d];J?L.push(J.promise):(J=e.extensions&&e.extensions[y.KHR_DRACO_MESH_COMPRESSION]?function(E){return a[y.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(E,t).then(function(F){return Tv(F,E,t)})}(e):Tv(new j,e,t),E[d]={primitive:e,promise:J},L.push(J))}return Promise.all(L)},loadMesh:function(j){for(var q=this,F=this.json,h=this.extensions,Z=F.meshes[j],A=Z.primitives,E=[],t=0,a=A.length;t<a;t++){var L=A[t].material===o?((L=this.cache).DefaultMaterial===o&&(L.DefaultMaterial=Q()),L.DefaultMaterial):this.getDependency("material",A[t].material);E.push(L)}return E.push(q.loadGeometries(A)),Promise.all(E).then(function(F){for(var E=F.slice(0,F.length-1),t=F[F.length-1],a=[],L=0,w=t.length;L<w;L++){var P=t[L],e=A[L],d=E[L],P=new f(P,d);e.mode!==o&&(d.renderMode=V[e.mode]||"triangles"),P.name=q.createUniqueName(Z.name||"mesh_"+j),W(P,Z),e.extensions&&Y(h,P,e),q.assignFinalMaterial(P),a.push(P)}for(L=0,w=a.length;L<w;L++)q.associations.set(a[L],{meshes:j,primitives:L});if(1===a.length)return a[0];var J=new x;q.associations.set(J,{meshes:j});for(L=0,w=a.length;L<w;L++)J.add(a[L]);return J})},loadCamera:function(F){return Promise.resolve(new r.Camera)},loadSkin:function(F){var F=this.json.skins[F],E={joints:F.joints};return F.inverseBindMatrices===o?Promise.resolve(E):this.getDependency("accessor",F.inverseBindMatrices).then(function(F){return E.inverseBindMatrices=F,E})},loadAnimation:function(r){for(var S=this.json.animations[r],F=[],E=[],t=[],a=[],L=[],i=this.nameIdGenerator,w=0,P=S.channels.length;w<P;w++){var e=S.channels[w],G=S.samplers[e.sampler],e=e.target,d=e.node,J=S.parameters!==o?S.parameters[G.input]:G.input,j=S.parameters!==o?S.parameters[G.output]:G.output;F.push(this.getDependency("node",d)),E.push(this.getDependency("accessor",J)),t.push(this.getDependency("accessor",j)),a.push(G),L.push(e)}return Promise.all([Promise.all(F),Promise.all(E),Promise.all(t),Promise.all(a),Promise.all(L)]).then(function(F){for(var E=F[0],t=F[1],a=F[2],L=F[4],w=[],P=0,e=E.length;P<e;P++){var d=E[P],J=t[P],j=a[P],q=L[P];if(d!==o){var h=G.interpolation,Z="CUBICSPLINE"===h?"cubicSpline":"STEP"===h?"discrete":"linear";"rotation"===q.path&&("cubicSpline"===Z?Z="cubicSplineQuaternion":"linear"===Z&&(Z="quaternion"));var h=(h=d.name)||(d.name="node"+i.next()),A=[],T=(q.path,A.push(h),j.array);if(j.normalized){for(var x=n(T.constructor),g=new Float32Array(T.length),f=0,s=T.length;f<s;f++)g[f]=T[f]*x;T=g}for(f=0,s=A.length;f<s;f++){var X={name:A[f]+"."+Jv[q.path],times:J.array,values:T,type:Z};w.push(X)}}}var F=S.name||"animation_"+r,$=0;return w.forEach(function(F){$=Math.max($,F.times[F.times.length-1])}),{name:F,duration:$,tracks:w}})},createNodeMesh:function(F){var E=this.json,t=this,a=E.nodes[F];return a.mesh===o?null:t.getDependency("mesh",a.mesh).then(function(F){F=t._getNodeRef(t.meshCache,a.mesh,F);return a.weights!==o&&F.traverse(function(F){if(F instanceof f)for(var E=0,t=a.weights.length;E<t;E++)F.morphTargetInfluences[E]=a.weights[E]}),F})},loadNode:function(d){var E,F=this.json,J=this.extensions,j=this,q=this.nameIdGenerator,h=F.nodes[d],Z=h.name?j.createUniqueName(h.name):"";return E=[],(F=j._invokeOne(function(F){return F.createNodeMesh&&F.createNodeMesh(d)}))&&E.push(F),h.camera!==o&&E.push(j.getDependency("camera",h.camera).then(function(F){return j._getNodeRef(j.cameraCache,h.camera,F)})),j._invokeAll(function(F){return F.createNodeAttachment&&F.createNodeAttachment(d)}).forEach(function(F){E.push(F)}),Promise.all(E).then(function(F){var E,t,a,L,w;if(!0===h.isBone?(E=new x).isBone=!0:E=!(1<F.length)&&1===F.length?F[0]:new x,E!==F[0])for(var P=0,e=F.length;P<e;P++)E.add(F[P]);return h.name&&(E.userData&&(E.userData.name=h.name),E.name=Z),E.isBone&&!E.name&&(E.name="node"+q.next()),W(E,h),h.extensions&&Y(J,E,h),h.matrix!==o?((t=new r.Math.Matrix4).fromArray(h.matrix),a=new S,L=new S,w=new r.Math.Quaternion,t.decompose(a,w,L),E.position=a.toArray(),E.scale=L.toArray(),E.quaternion=w.toArray()):(h.translation!==o&&(E.position=h.translation),h.rotation!==o&&(E.quaternion=h.rotation),h.scale!==o&&(E.scale=h.scale)),j.associations.has(E)||j.associations.set(E,{}),j.associations.get(E).nodes=d,E})},loadScene:function(F){for(var E=this.json,t=this.extensions,F=this.json.scenes[F],L=this,a=new x,w=(F.name&&(a.name=L.createUniqueName(F.name)),W(a,F),F.extensions&&Y(t,a,F),F.nodes||[]),P=[],e=0,d=w.length;e<d;e++)P.push(function P(F,e,d,J){var j=d.nodes[F];return J.getDependency("node",F).then(function(F){return j.skin===o?F:J.getDependency("skin",j.skin).then(function(F){for(var E=[],t=0,a=(e=F).joints.length;t<a;t++)E.push(J.getDependency("node",e.joints[t]));return Promise.all(E)}).then(function(P){return F.traverse(function(F){if(F instanceof f){for(var E=[],t=[],a=0,L=P.length;a<L;a++){var w=P[a];w?(E.push(w),w=new g,e.inverseBindMatrices!==o&&w.fromArray(e.inverseBindMatrices.array,16*a),w.toArray(t,t.length)):console.warn("Joint %s could not be found.",e.joints[a])}F.skeleton=[E,t,F.matrixWorld]}}),F});var e}).then(function(F){e.add(F);var E=[];if(j.children)for(var t=j.children,a=0,L=t.length;a<L;a++){var w=t[a];E.push(P(w,F,d,J))}return Promise.all(E)})}(w[e],a,E,L));return Promise.all(P).then(function(){return L.associations=function(F){var E,t=new Map;for(E in L.associations){var a=parse.associations[E];(E instanceof q||E instanceof J)&&t.set(E,a)}return F.traverse(function(F){var E=L.associations.get(F);null!=E&&t.set(F,E)}),t}(a),a})}});var z=new WeakMap,xv=function(){this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}};w.assign(xv.prototype,{setDecoderPath:function(F){return this.decoderPath=F,this},setDecoderConfig:function(F){return this.decoderConfig=F,this},setWorkerLimit:function(F){return this.workerLimit=F,this},load:function(F,E,t,a){var L=this,w=L.path+F;r.Default.xhrLoad(w,function(F){F?L.decodeDracoFile(F,E).catch(a):a("Failed to load "+w)},{responseType:"arraybuffer"})},decodeDracoFile:function(F,E,t,a){a={attributeIDs:t||this.defaultAttributeIDs,attributeTypes:a||this.defaultAttributeTypes,useUniqueIDs:!!t};return this.decodeGeometry(F,a).then(E)},decodeGeometry:function(t,a){var F=JSON.stringify(a);if(z.has(t)){var E=z.get(t);if(E.key===F)return E.promise;if(0===t.byteLength)throw new Error("DRACOLoader: Unable to decode a buffer.")}var L,w=this,P=w.workerNextTaskID++,E=t.byteLength,E=w._getWorker(P,E).then(function(F){return L=F,new Promise(function(F,E){L._callbacks[P]={resolve:F,reject:E},L.postMessage({type:"decode",id:P,taskConfig:a,buffer:t},[t])})}).then(function(F){return w._createGeometry(F.geometry)});return E.catch(function(){return!0}).then(function(){L&&P&&w._releaseTask(L,P)}),z.set(t,{key:F,promise:E}),E},_createGeometry:function(F){var E=new j;F.index&&E.setIndex(new $(F.index.array,1));for(var t=0;t<F.attributes.length;t++){var a=F.attributes[t],L=a.name,w=a.array,a=a.itemSize;E.setAttribute(L,new $(w,a))}return E},_loadLibrary:function(F,a){var L=this.decoderPath+F;return new Promise(function(E,t){r.Default.xhrLoad(L,function(F){F?E(F):t("Failed to load "+L)},{responseType:a})})},preload:function(){return this._initDecoder(),this},_initDecoder:function(){var t=this;if(t.decoderPending)return t.decoderPending;var a="object"!=typeof WebAssembly||"js"===t.decoderConfig.type,F=[];return a?F.push(t._loadLibrary("draco_decoder.js","text")):(F.push(t._loadLibrary("draco_wasm_wrapper.js","text")),F.push(t._loadLibrary("draco_decoder.wasm","arraybuffer"))),t.decoderPending=Promise.all(F).then(function(F){var E=F[0],F=(a||(t.decoderConfig.wasmBinary=F[1]),function(){var t,E;function d(F,E,t,a){var L,w=a.attributeIDs,P=a.attributeTypes,e=E.GetEncodedGeometryType(t);if(e===F.TRIANGULAR_MESH)L=new F.Mesh,s=E.DecodeBufferToMesh(t,L);else{if(e!==F.POINT_CLOUD)throw new Error("DRACOLoader: Unexpected geometry type.");L=new F.PointCloud,s=E.DecodeBufferToPointCloud(t,L)}if(!s.ok()||0===L.ptr)throw new Error("DRACOLoader: Decoding failed: "+s.error_msg());var d,J,j,q,h,Z,A,T,x,g,f,s,X,$,r,S={index:null,attributes:[]};for(d in w){var i,G,o=self[P[d]];if(a.useUniqueIDs)G=w[d],i=E.GetAttributeByUniqueId(L,G);else{if(-1===(G=E.GetAttributeId(L,F[w[d]])))continue;i=E.GetAttribute(L,G)}S.attributes.push((J=F,j=E,q=L,h=d,o=o,f=g=x=T=A=void 0,A=(Z=i).num_components(),T=q.num_points()*A,x=T*o.BYTES_PER_ELEMENT,g=function(F,E){switch(E){case Float32Array:return F.DT_FLOAT32;case Int8Array:return F.DT_INT8;case Int16Array:return F.DT_INT16;case Int32Array:return F.DT_INT32;case Uint8Array:return F.DT_UINT8;case Uint16Array:return F.DT_UINT16;case Uint32Array:return F.DT_UINT32}}(J,o),f=J._malloc(x),j.GetAttributeDataArrayForAllPoints(q,Z,g,x,f),j=new o(J.HEAPF32.buffer,f,T).slice(),J._free(f),{name:h,array:j,itemSize:A}))}return e===F.TRIANGULAR_MESH&&(S.index=(t=F,s=E,X=3*(e=L).num_faces(),$=4*X,r=t._malloc($),s.GetTrianglesUInt32Array(e,$,r),s=new Uint32Array(t.HEAPF32.buffer,r,X).slice(),t._free(r),{array:s,itemSize:1})),F.destroy(L),S}onmessage=function(F){var w=F.data;switch(w.type){case"init":t=w.decoderConfig,E=new Promise(function(E){t.onModuleLoaded=function(F){E({draco:F})},DracoDecoderModule(t)});break;case"decode":var P=w.buffer,e=w.taskConfig;E.then(function(F){var F=F.draco,E=new F.Decoder,t=new F.DecoderBuffer;t.Init(new Int8Array(P),P.byteLength);try{var a=d(F,E,t,e),L=a.attributes.map(function(F){return F.array.buffer});a.index&&L.push(a.index.array.buffer),self.postMessage({type:"decode",id:w.id,geometry:a},L)}catch(F){console.error(F),self.postMessage({type:"error",id:w.id,error:F.message})}finally{F.destroy(t),F.destroy(E)}})}}}.toString()),E=["/* draco decoder */",E,"","/* worker */",F.substring(F.indexOf("{")+1,F.lastIndexOf("}"))].join("\n");t.workerSourceURL=URL.createObjectURL(new Blob([E]))}),t.decoderPending},_getWorker:function(F,E){var a=this;return a._initDecoder().then(function(){a.workerPool.length<a.workerLimit?((t=new Worker(a.workerSourceURL))._callbacks={},t._taskCosts={},t._taskLoad=0,t.postMessage({type:"init",decoderConfig:a.decoderConfig}),t.onmessage=function(F){var E=F.data;switch(E.type){case"decode":t._callbacks[E.id].resolve(E);break;case"error":t._callbacks[E.id].reject(E);break;default:console.error('DRACOLoader: Unexpected message, "'+E.type+'"')}},a.workerPool.push(t)):a.workerPool.sort(function(F,E){return F._taskLoad>E._taskLoad?-1:1});var t=a.workerPool[a.workerPool.length-1];return t._taskCosts[F]=E,t._taskLoad+=E,t})},_releaseTask:function(F,E){F._taskLoad-=F._taskCosts[E],delete F._callbacks[E],delete F._taskCosts[E]},debug:function(){},dispose:function(){for(var F=0;F<this.workerPool.length;++F)this.workerPool[F].terminate();return this.workerPool.length=0,this}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);