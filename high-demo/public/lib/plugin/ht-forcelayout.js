!function(k,Y){"use strict";function i(k){return k*k}var L="ht.layout.",A=k.ht||module.parent.exports.ht,s=A.List,U=A.DataModel,D=A.Node,h=A.Edge,M=A.Group,k=Math,u=k.sqrt,F=k.random,G=k.max,$=k.min,I=(A.Default.getInternal().addMSMap({ms_force:function(k,Y){k._interval=50,k._stepCount=10,k._motionLimit=.01,k._edgeRepulsion=.65,k._nodeRepulsion=.65,k._damper=1,k._maxMotion=0,k._motionRatio=0,k.init=function(k){var Y=this;k instanceof U?Y.dm=k:Y.gv=k,Y._nodeMap={},Y._nodes=new s,Y._edges=new s},k.start=function(){var k,L=this,Y=L.gv;L._timer||((k=L.cdm=Y?Y.dm():L.dm).mm(L.handleDataModelChange,L),k.md(L.handleDataPropertyChange,L),Y&&Y.mp(L.handleGV,L),k.each(function(k){var Y;L.isVisible(k)&&L.isLayoutable(k)&&k instanceof D&&(L instanceof I?(Y=k.p3(),k.p3([Y[0]+F(),Y[1]+F(),Y[2]+F()])):(Y=k.p(),k.p(Y.x+F(),Y.y+F())))}),L._timer=setInterval(function(){L.relax()},L._interval),L._damper=1)},k.stop=function(){var k=this;k._timer&&(k.cdm.umm(k.handleDataModelChange,k),k.cdm.umd(k.handleDataPropertyChange,k),k.gv&&k.gv.ump(k.handleGV,k),clearInterval(k._timer),delete k._timer,delete k.cdm)},k.handleGV=function(k){var Y,L=this;"dataModel"===k.property&&(Y=k.oldValue,k=k.newValue,Y&&(Y.umm(L.handleDataModelChange,L),Y.umd(L.handleDataPropertyChange,L)),(this.cdm=k).mm(L.handleDataModelChange,L),k.md(L.handleDataPropertyChange,L))},k.relax=function(){var Y=this;if(!(Y._damper<.1&&Y._maxMotion<Y._motionLimit)){this.cdm.each(function(k){Y.isVisible(k)&&(k instanceof h?Y.addEdge(k):k instanceof D&&Y.addNode(k))});for(var k,L,s=0,i=Y._edges,A=Y._nodes,U=A.size();s<Y._stepCount;s++){for(i.each(Y.relaxEdge,Y),k=0;k<U;k++)for(L=0;L<U;L++)Y.relaxNode(A.get(k),A.get(L));Y.moveNode()}Y._isAdjusting=1,A.each(function(k){k.fix||(k.p?k.v.p3(k.p):k.v.p(k.x,k.y))}),delete Y._isAdjusting,Y._nodeMap={},A.clear(),i.clear(),Y.onRelaxed()}},k.onRelaxed=function(){},k.isRunning=function(){return!!this._timer},k.isVisible=function(k){return!1!==k.s("layoutable")&&(!this.gv||this.gv.isVisible(k))},k.isLayoutable=function(k){if(!1===k.s("layoutable"))return!1;if(k instanceof M)return!1;var Y=this;return Y.gv?Y.gv.isMovable(k)&&!Y.gv.isSelected(k):!(Y.cdm||Y.dm).sm().co(k)},k.getNodeRepulsion=function(){return this._nodeRepulsion},k.setNodeRepulsion=function(k){this._nodeRepulsion=k,this._damper=1},k.getEdgeRepulsion=function(){return this._edgeRepulsion},k.setEdgeRepulsion=function(k){this._edgeRepulsion=k,this._damper=1},k.getStepCount=function(){return this._stepCount},k.setStepCount=function(k){this._stepCount=k,this._damper=1},k.getInterval=function(){return this._interval},k.setInterval=function(k){var Y=this;Y._interval!==k&&(Y._interval=k,Y._timer&&(clearInterval(Y._timer),Y._timer=setInterval(function(){Y.relax()},k)))},k.handleDataPropertyChange=function(k){!this._isAdjusting&&this.isVisible(k.data)&&(this._damper=1)},k.handleDataModelChange=function(k){this._damper=1},k.damp=function(){var k=this._maxMotion,Y=this._damper;this._motionRatio<=.001&&((k<.2||1<k&&Y<.9)&&.01<Y?this._damper-=.01:k<.4&&.003<Y?this._damper-=.003:1e-4<Y&&(this._damper-=1e-4)),k<this._motionLimit&&(this._damper=0)}}}),A.layout.ForceLayout=function(k){this.init(k)},A.Default.def(L+"ForceLayout",Y,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(k){this._limitBounds=k,this._damper=1},getNodeSize:function(k){var Y=this.gv;return Y&&Y.getDataUIBounds?Y.getDataUIBounds(k):k.getRect()},addNode:function(k){var Y=this,L=Y._nodeMap[k._id];if(L)return L;var s=k.p(),s=(L={v:k,x:s.x,y:s.y,dx:0,dy:0,fix:!Y.isLayoutable(k),s:Y.getNodeSize(k)}).s,s=u(i(s.width)+i(s.height))*Y._nodeRepulsion;return L.r=s<1?100:s,Y._nodeMap[k._id]=L,Y._nodes.add(L),L},addEdge:function(k){var Y,L,s;k._40I&&k._41I&&(Y={s:L=this.addNode(k._40I),t:k=this.addNode(k._41I)},k=k.s,L=L.s,s=k.width+L.width,k=k.height+L.height,Y.length=u(s*s+k*k)*this._edgeRepulsion,Y.length<=0&&(Y.length=100),this._edges.add(Y))},relaxEdge:function(k){var Y=k.t,L=k.s,s=Y.x-L.x,i=Y.y-L.y,A=u(s*s+i*i),k=100*k.length,s=.25*s/k*A,i=.25*i/k*A;Y.dx=Y.dx-s,Y.dy=Y.dy-i,L.dx=L.dx+s,L.dy=L.dy+i},relaxNode:function(k,Y){var L,s,i,A,U;k!==Y&&((s=L=0)==(A=(U=k.x-Y.x)*U+(i=k.y-Y.y)*i)?(L=F(),s=F()):A<36e4&&(L=U/A,s=i/A),s*=U=k.r*Y.r/400,k.dx+=L*=U,k.dy+=s,Y.dx-=L,Y.dy-=s)},moveNode:function(){var s=this,i=s._limitBounds,k=s._maxMotion,A=0,U=s._damper;s._nodes.each(function(k){var Y,L;k.fix||(L=k.dx*U,Y=k.dy*U,k.dx=L/2,k.dy=Y/2,A=G(u(L*L+Y*Y),A),k.x+=G(-40,$(40,L)),k.y+=G(-40,$(40,Y)),i&&(k.x<i.x&&(k.x=i.x,s.adjust(1,0)),k.y<i.y&&(k.y=i.y,s.adjust(0,1)),L=k.s,k.x+L.width>i.x+i.width&&(k.x=i.x+i.width-L.width,s.adjust(-1,0)),k.y+L.height>i.y+i.height&&(k.y=i.y+i.height-L.height,s.adjust(0,-1))))}),s._maxMotion=A,s._motionRatio=0<A?k/A-1:0,s.damp()},adjust:function(Y,L){var s=this._limitBounds;this._nodes.each(function(k){0<Y?(!s||k.x+k.s.width+Y<s.x+s.width)&&(k.x+=Y):(!s||k.x+Y>s.x)&&(k.x+=Y),0<L?(!s||k.y+k.s.height+L<s.y+s.height)&&(k.y+=L):(!s||k.y+L>s.y)&&(k.y+=L)})}}),A.layout.Force3dLayout=function(k){this.init(k)});A.Default.def(L+"Force3dLayout",Y,{ms_force:1,getNodeSize3d:function(k){return k.s3()},addNode:function(k){var Y=this,L=Y._nodeMap[k._id];if(L)return L;var s=(L={v:k,p:k.p3(),d:[0,0,0],fix:!Y.isLayoutable(k),s:Y.getNodeSize3d(k)}).s,s=A.Default.getDistance(s)*Y._nodeRepulsion;return L.r=s<1?100:s,Y._nodeMap[k._id]=L,Y._nodes.add(L),L},addEdge:function(k){var Y,L;k._40I&&k._41I&&(Y={s:L=this.addNode(k._40I),t:k=this.addNode(k._41I)},k=k.s,L=L.s,Y.length=u(i(k[0]+L[0])+i(k[1]+L[1])+i(k[2]+L[2]))*this._edgeRepulsion,Y.length<=0&&(Y.length=100),this._edges.add(Y))},relaxEdge:function(k){var Y=k.t.p,L=k.s.p,s=k.t.d,i=k.s.d,A=Y[0]-L[0],U=Y[1]-L[1],Y=Y[2]-L[2],L=u(A*A+U*U+Y*Y),k=100*k.length,A=.25*A/k*L,U=.25*U/k*L,Y=.25*Y/k*L;s[0]-=A,s[1]-=U,s[2]-=Y,i[0]+=A,i[1]+=U,i[2]+=Y},relaxNode:function(k,Y){var L,s,i,A,U,D,h;k!==Y&&(h=k.p,A=Y.p,(i=s=L=0)==(A=(U=h[0]-A[0])*U+(D=h[1]-A[1])*D+(h=h[2]-A[2])*h)?(L=F(),s=F(),i=F()):A<216e6&&(L=U/A,s=D/A,i=h/A),U=k.r*Y.r/400,D=k.d,h=Y.d,s*=U,i*=U,D[0]+=L*=U,D[1]+=s,D[2]+=i,h[0]-=L,h[1]-=s,h[2]-=i)},moveNode:function(){var k=this,Y=k._maxMotion,A=0,U=k._damper;k._nodes.each(function(k){var Y,L,s,i;k.fix||(Y=k.p,L=(k=k.d)[0]*U,s=k[1]*U,i=k[2]*U,k[0]=L/2,k[1]=s/2,k[2]=i/2,A=G(u(L*L+s*s+i*i),A),Y[0]+=G(-40,$(40,L)),Y[1]+=G(-40,$(40,s)),Y[2]+=G(-40,$(40,i)))}),k._maxMotion=A,k._motionRatio=0<A?Y/A-1:0,k.damp()}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);