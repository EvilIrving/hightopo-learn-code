!function(j){"use strict";function N(j,O){for(var A=[],$=j.length,I=0;I<$;I++)for(var U=j[I],F=(U=U._as?U._as:U)[0],V=1;V<U.length;V++)A.push([F,U[V]]),F=U[V];for(var m=[],I=0;I<A.length;I++){var s=E(A[I][0],A[I][1],O);m.push(s)}return{distance:m,segments:A}}function I(j,O,A){if(j){for(var $,j=N(j,O),I=j.distance,U=j.segments,F=1/0,V=null,m=0,s=I.length;m<s;m++){var T=I[m];T.z<F&&($=m,F=T.z,V=T)}if(V.z<(A=null==A?.1:A)){for(var Y=0,H=0;H<=$;H++)Y+=l.getDistance(U[H][0],H<$?U[H][1]:V);return Y}}}function $(j,O){var A,$;if(j)return j=N(j,O).distance,A=1/0,$=null,j.forEach(function(j){j.z<A&&(A=j.z,$=j)}),$}function U(j,O,A){if(!j)return A;if(0===O)return X=j[0][0],H=j[0][1],A+Math.atan2(H.y-X.y,H.x-X.x);if(100===O)return X=(j=j[j.length-1])[j.length-2],H=j[j.length-1],A+Math.atan2(H.y-X.y,H.x-X.x);for(var $=0,I=[],U=j.length,F=0;F<U;F++){var V=j[F],V=z(V);$+=V,I.push(V)}for(var m=$*O/100,s=i(m,I),T=0,Y=0;Y<s;Y++)T+=I[Y];for(var H=p(j[s],m-=T),N=j[s],l=0,c=0,r=0;r<N.length-1;r++){var o=N[r],y=N[r+1],S=y.x-o.x,y=y.y-o.y;if(m<(l+=Math.sqrt(S*S+y*y))){c=r;break}}var X=N[c];return A+Math.atan2(H.y-X.y,H.x-X.x)}function A(j){var O=0;if(j)if(Array.isArray(j[0]))for(var A=j.length,$=0;$<A;$++){var I=j[$];O+=z(I)}else O=z(j);return O}function F(j){var O=j._data,A=Y(j);if(A){O.s("flow.reverse")&&(A.reverse(),A.forEach(function(j){j.reverse()}));for(var $,I,U=0,F=[],V=A.length,m=0;m<V;m++){var s=A[m],s=z(s);U+=s,F.push(s)}O[_]=F,O[h]=U,O[v]=A,O instanceof T.Edge&&($=(I=l.unionPoint(A)).x+I.width/2,I=I.y+I.height/2,O.$10e={x:$,y:I}),w(j,!0)}}function b(j){var O,A=j.data,$=this.dm();A&&"add"===j.kind&&(O=$.$3e)&&A.s(V)&&O.indexOf(A)<0&&O.push(A),"clear"===j.kind&&($.$3e=[])}function C(j){var O=j.property,A=j.data,j=j.newValue,$=this.dm().$3e;if($&&"s:flow"===O)if(j)$.indexOf(A)<0&&$.push(A);else for(var I=$.length,U=0;U<I;U++)if($[U]===A){$.splice(U,1);break}}function Q(o){var j,y=this,S=y._data,X=S[h],k=S[_],z=S[v],O=S.s(D),A=y[f],$=S.s(L),I=S.s(u),U=S.s(a),F=S.s(x),V=S.s(J),P=S.s(W),m=(V-F)/(U-1),s=($-I)/(U-1),b=S.getRotation?S.getRotation():0,C=S.getPosition?S.p():S.$10e,Q=[],q=[];if(A!=r){if(1===U)Q.push($);else if(2===U)Q.push($),Q.push(I);else{if(!(2<U))return;Q.push($);for(var T=U-2;0<T;T--)Q.push(I+s*T);Q.push(I)}if(1===U)q.push(V);else if(2===U)q.push(V),q.push(F);else{if(!(2<U))return;q.push(V);for(T=U-2;0<T;T--)q.push(F+m*T);q.push(F)}var R=0,Y=0;Q.forEach(function(j){R<U-1&&(Y+=S.getFlowElementSpace(j)),R++}),j=(X-O*(Y+=($+I)/2)+Y)/O,o.save();for(T=0;T<O;T++){var G=A,E=0,H=y._overCount,K=0;S.s("flow.autoreverse")&&H&&O-(T+1)<H||(G-=T*(j+Y),R=0,Q.forEach(function(j){var O,A,$,I=G-E;if(0<=I&&I<X){for(var U=i(I,k),F=K=0;F<U;F++)K+=k[F];I-=K;var V=p(z[U],I),m=b;if(P){for(var s=z[U],T=0,Y=0,H=0;H<s.length-1;H++){var N=s[H],l=s[H+1],c=l.x-N.x,l=l.y-N.y;if(I<(T+=Math.sqrt(c*c+l*l))){Y=H;break}}var r=s[Y];m+=Math.atan2(V.y-r.y,V.x-r.x)}b&&(r=C,O=V.x-C.x,A=V.y-C.y,$=b,M.set(O,A).rotateAround(null,$),V=r?{x:r.x+M.x,y:r.y+M.y}:{x:M.x,y:M.y}),y.$5e(o,V,j,q[R],m)}E+=S.getFlowElementSpace(Q[R]),R++}))}o.restore()}}function q(){var j,O=this,A=O._data,$=A.s(L),I=!1,U=r;return O._6I||(I=!0),U=(A instanceof T.Edge?Z:B).call(O),A.s(V)&&I&&(j=A.s(J),0<($=A.s(k)&&$<j?j:$)&&l.grow(U,Math.ceil($/2)),F(O)),!A.s(V)&&I&&(A[_]=A[h]=A[v]=O[f]=r),U}function R(j){this.__flowBatchGroup={}}function G(O){var j=this.__flowBatchGroup;if(j){for(var A in O.save(),j)O.fillStyle=A,O.beginPath(),j[A].forEach(function(j){O.moveTo(j[0],j[1]),O.arc(j[0],j[1],j[2],0,2*Math.PI,!0)}),O.fill();O.restore()}}var T=j.ht,l=T.Default,c=l.getInternal(),j=c.ui(),r=null,_="__segmentLengths",h="__lineTotalLength",v="__linePoints",f="__distance0",D="flow.count",y="flow.step",L="flow.element.max",a="flow.element.count",u="flow.element.min",O="flow.element.space",W="flow.element.autorotate",o="flow.element.background",J="flow.element.shadow.max",x="flow.element.shadow.min",S="flow.element.shadow.begincolor",X="flow.element.shadow.endcolor",k="flow.element.shadow.visible",V="flow",m=T.Math.Vector2,M=new m,m=(new m,new m,T.List,T.Default._edgeProtectMethod),Y=m.getStraightLinePoints,E=function(j,O,A){var $=j.x,I=j.y,U=O.x,F=O.y,V=A.x,A=A.y,U=U-$,F=F-I,m=Math.sqrt(U*U+F*F),s=U/m,m=F/m,T=(-$+V)*s+(-I+A)*m,$={x:$+T*s,y:I+T*m};return $.x>=Math.min(j.x,O.x)&&$.x<=Math.max(j.x,O.x)&&$.y>=Math.min(j.y,O.y)&&$.y<=Math.max(j.y,O.y)||($.x=(Math.abs($.x-j.x)<Math.abs($.x-O.x)?j:O).x,$.y=(Math.abs($.y-j.y)<Math.abs($.y-O.y)?j:O).y),U=V-$.x,F=A-$.y,$.z=Math.sqrt(U*U+F*F),$},z=m.calculateLineLength,i=m.calcSegmentIndexByDistance,p=m.calculatePointAlongLine,K=m.getPercentPosition,w=function(j,O){var A,$=j._data,I=$[h],U=$.s(D),F=$.s(y),V=$[_],m=$.s(L),s=$.s(u),T=$.s(a),Y=(m-s)/(T-1),H=[];if(V){if(1===T)H.push(m);else if(2===T)H.push(m),H.push(s);else{if(!(2<T))return;H.push(m);for(var N=T-2;0<N;N--)H.push(s+Y*N);H.push(s)}var l=0,c=0,r=(H.forEach(function(j){l<T-1&&(c+=$.getFlowElementSpace(j)),l++}),A=(I-U*(c+=(m+s)/2)+c)/U,j[f]);for(null==r&&(r=0),O||(r+=F);I+c<r;){var o=j._overCount;o?o++:o=1,U<=o&&(o=null),j._overCount=o,!$.s("flow.autoreverse")||o?r-=A+c:(r=0,$.s("flow.reverse",!$.s("flow.reverse")))}j[f]=r}},m="prototype",s=T.graph.GraphView[m],g=T.Data[m],d=j.DataUI[m],H=j.ShapeUI[m],j=j.EdgeUI[m],m=T.DataModel[m],P=T.Style,t=(P[L]==r&&(P[L]=7),P[u]==r&&(P[u]=0),P[D]==r&&(P[D]=1),P[y]==r&&(P[y]=3),P[a]==r&&(P[a]=10),P[O]==r&&(P[O]=3.5),P[W]==r&&(P[W]=!1),P[o]==r&&(P[o]="rgba(255, 255, 114, 0.4)"),P[S]==r&&(P[S]="rgba(255, 255, 0, 0.3)"),P[X]==r&&(P[X]="rgba(255, 255, 0, 0)"),P[k]==r&&(P[k]=1),P[J]==r&&(P[J]=22),P[x]==r&&(P[x]=4),s.calculatePointLength=function(j,O,A){j=this.getDataUI(j),j=Y(j);return I(j,O,A)},l.calculatePointLength=function(j,O,A,$){j=Y(r,j,O);return I(j,A,$)},l.calculateClosestPointOnLine=E,s.calculateClosestPoint=function(j,O){j=this.getDataUI(j),j=Y(j);return $(j,O)},l.calculateClosestPoint=function(j,O,A){j=Y(r,j,O);return $(j,A)},s.getPercentAngle=function(j,O){var A=this.getDataUI(j),A=Y(A);j.getRotation&&j.getRotation();return U(A,O,j.getRotation?j.getRotation():0)},l.getPercentAngle=function(j,O,A){j=Y(r,j,O);return U(j,A,0)},s.calculateLength=function(j){j=this.getDataUI(j),j=Y(j);return A(j)},l.calculateLength=function(j,O){j=Y(r,j,O);return A(j)},s.getPercentPosition=function(j,O){j=this.getDataUI(j),j=Y(j);return K(j,O)},l.getPercentPositionOnPoints=function(j,O,A){j=Y(r,j,O);return K(j,A)},s.setDataModel),e=(s.setDataModel=function(j){var O,A=this,$=A._dataModel;$!==j&&($&&($.umm(b,A),$.umd(C,A),$.$3e=[]),j.mm(b,A),j.md(C,A),O=j.$3e=[],j.each(function(j){j.s(V)&&O.indexOf(j)<0&&O.push(j)}),t.call(A,j))},g.getFlowElementSpace=function(j){return this.s(O)},j.drawBody),n=(j.drawBody=function(j){e.call(this,j);var O=this._data,A=this.gv;O.s(V)&&A.$7e!=r&&Q.call(this,j)},H.drawBody),Z=(H.drawBody=function(j){n.call(this,j);var O=this._data,A=this.gv;O.s(V)&&A.$7e!=r&&Q.call(this,j)},j._79o),B=H._79o,jA=(H._79o=q,j._79o=q,d.$5e=function(j,O,A,$,I){var U,F=this._data,V=this.gv,m=F.s(o),s=F.s(S),T=F.s(X),Y=F.s(k),H=V.$8e,N=F.s("flow.element.image");H==r&&(H=V.$8e={}),j.beginPath(),N!=r?(N=l.getImage(N),U=A/2,j.translate(O.x,O.y),j.rotate(I),j.translate(-O.x,-O.y),l.drawImage(j,N,O.x-U,O.y-U,A,A,F),j.translate(O.x,O.y),j.rotate(-I),j.translate(-O.x,-O.y)):V.__flowBatch?(N=(N=V.__flowBatchGroup)||(V.__flowBatchGroup={}),I=[O.x,O.y,A/2],N[m]?N[m].push(I):N[m]=[I]):(j.fillStyle=m,j.arc(O.x,O.y,A/2,0,2*Math.PI,!0),j.fill()),Y&&((N=H[V="22_"+s+"_"+T])==r&&(I=document.createElement("canvas"),c.setCanvas(I,22,22),m=I.getContext("2d"),c.translateAndScale(m,0,0,1),m.beginPath(),(A=m.createRadialGradient(11,11,0,11,11,11)).addColorStop(0,s),A.addColorStop(1,T),m.fillStyle=A,m.arc(11,11,11,0,2*Math.PI,!0),m.fill(),N=H[V]=I),l.drawImage(j,N,O.x-(U=$/2),O.y-U,$,$,F))},s.$9e=function(){var O=this,j=O.dm().$3e;O._24I;j.forEach(function(j){O._24I[j._id]=j}),O.iv()},m.prepareRemove);m.prepareRemove=function(j){jA.call(this,j);var O=j._dataModel.$3e;if(O)for(var A=O.length,$=0;$<A;$++)if(O[$]===j){O.splice($,1);break}},s.setFlowInterval=function(j){var O=this,A=O.$11e;O.$11e=j,O.fp("flowInterval",A,j),O.$7e!=r&&(clearInterval(O.$7e),delete O.$7e,O.enableFlow(j))},s.getFlowInterval=function(){return this.$11e},s.enableFlow=function(j){var O=this,A=O.dm(),$=A.$3e;O.$7e==r&&($.forEach(function(j){j=O.getDataUI(j);F(j)}),O.$7e=setInterval(function(){A.$3e.forEach(function(j){w(O.getDataUI(j))}),O.$9e()},j||O.$11e||50))},s.disableFlow=function(){clearInterval(this.$7e),delete this.$7e,this.dm().$3e&&this.$9e()};s.setFlowBatch=function(j){var O=this;!!O.__flowBatch!=!!j&&((O.__flowBatch=j)?(O.addBottomPainter(R),O.addTopPainter(G)):(O.removeBottomPainter(R),O.removeTopPainter(G)))}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);