!function(f){"use strict";var J=ht.AlarmSeverity=function(f,b,y,x,A){this.value=f,this.name=b,this.nickName=y,this.color=x,this.displayName=A},b=(ht.Default.def("ht.AlarmSeverity",f,{toString:function(){return this.displayName||this.name}}),J.severities=new ht.List,J._vm={},J._nm={},J._cp=function(f,b){var y;return f&&b?0<(y=f.value-b.value)?1:y<0?-1:0:f&&!b?1:!f&&b?-1:0},J.each=function(f,b){J.severities.each(f,b)},J.getSortFunction=function(){return J._cp},J.setSortFunction=function(f){J._cp=f,J.severities.sort(f)},J.add=function(f,b,y,x,A){y=new J(f,b,y,x,A);return J._vm[f]=y,J._nm[b]=y,J.severities.add(y),J.severities.sort(J._cp),y},J.remove=function(f){var b=J._nm[f];return b&&(delete J._nm[f],delete J._vm[b.value],J.severities.remove(b)),b},J.CRITICAL=J.add(500,"Critical","C","#FF0000"),J.MAJOR=J.add(400,"Major","M","#FFA000"),J.MINOR=J.add(300,"Minor","m","#FFFF00"),J.WARNING=J.add(200,"Warning","W","#00FFFF"),J.INDETERMINATE=J.add(100,"Indeterminate","N","#C800FF"),J.CLEARED=J.add(0,"Cleared","R","#00FF00"),J.isClearedAlarmSeverity=function(f){return!!f&&0===f.value},J.getByName=function(f){return J._nm[f]},J.getByValue=function(f){return J._vm[f]},J.clear=function(){J.severities.clear(),J._vm={},J._nm={}},J.compare=function(f,b){return J._cp(f,b)},ht.AlarmState=function(f){this._d=f,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0}),y=(ht.Default.def("ht.AlarmState",f,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._d.fp("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var f,b=null;for(f in this._am)f=J.getByName(f),J.isClearedAlarmSeverity(f)||0!==this.getAcknowledgedAlarmCount(f)&&(b=b&&0<J.compare(b,f)?b:f);this._haa=b},_c2:function(){var f,b=null;for(f in this._nm)f=J.getByName(f),J.isClearedAlarmSeverity(f)||0!==this.getNewAlarmCount(f)&&(b=b&&0<J.compare(b,f)?b:f);this._hna=b},_c3:function(){if(this._hna){for(var f in this._nm)if(f=J.getByName(f),!J.isClearedAlarmSeverity(f)&&0!==this.getNewAlarmCount(f)&&0<J.compare(this._hna,f))return void(this._hls=!0);this._hls=!1}else this._hls=!1},_c4:function(){var f=this._haa,b=this._hna,y=this._ps;this._hoa=f,0<J.compare(b,this._hoa)&&(this._hoa=b),0<J.compare(y,this._hoa)&&(this._hoa=y)},_c5:function(){var f=this._haa,b=this._hna;this._hta=f,0<J.compare(b,this._hta)&&(this._hta=b)},increaseAcknowledgedAlarm:function(f,b){var y;0!==b&&(y=this._am[f.name]||0,this._am[f.name]=y+=b=b||1,this._f())},increaseNewAlarm:function(f,b){var y;0!==b&&(y=this._nm[f.name]||0,this._nm[f.name]=y+=b=b||1,this._f())},decreaseAcknowledgedAlarm:function(f,b){if(0!==b){var y=this._am[f.name]||0;if((y-=b=b||1)<0)throw"Alarm count can not be negative";this._am[f.name]=y,this._f()}},decreaseNewAlarm:function(f,b){if(0!==b){var y=this._nm[f.name]||0;if((y-=b=b||1)<0)throw"Alarm count can not be negative";this._nm[f.name]=y,this._f()}},acknowledgeAlarm:function(f){this.decreaseNewAlarm(f,1),this.increaseAcknowledgedAlarm(f,1)},acknowledgeAllAlarms:function(f){if(f){var b=this.getNewAlarmCount(f);this.decreaseNewAlarm(f,b),this.increaseAcknowledgedAlarm(f,b)}else for(var y in this._nm)this.acknowledgeAllAlarms(J.getByName(y))},_c6:function(){for(var f in this._aac=0,this._am)f=J.getByName(f),this._aac+=this.getAcknowledgedAlarmCount(f)},getAcknowledgedAlarmCount:function(f){return f?this._am[f.name]||0:this._aac},getAlarmCount:function(f){return this.getAcknowledgedAlarmCount(f)+this.getNewAlarmCount(f)},_c7:function(){for(var f in this._nac=0,this._nm)this._nac+=this.getNewAlarmCount(J.getByName(f))},getNewAlarmCount:function(f){return f?this._nm[f.name]||0:this._nac},setNewAlarmCount:function(f,b){this._nm[f.name]=b,this._f()},removeAllNewAlarms:function(f){f?delete this._nm[f]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(f,b){this._am[f.name]=b,this._f()},removeAllAcknowledgedAlarms:function(f){f?delete this._am[f.name]:this._am={},this._f()},isEmpty:function(){return!this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(f){var b;this._ep||(f=null),this._ps!==f&&(b=this._ps,this._ps=f,this._f(),this._d.fp("propagateSeverity",b,f))},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(f){var b=this._ep;this._ep=f,this._d.fp("enablePropagation",b,f)&&!f&&this.setPropagateSeverity(null)}}),ht.AlarmStatePropagator=function(f){this._dataModel=f,this._enable=!1,this._isPropagating=!1}),f=(ht.Default.def("ht.AlarmStatePropagator",f,{getDataModel:function(){return this._dataModel},isEnable:function(){return this._enable},setEnable:function(f){this._enable!==f&&(this._enable=f,this._enable?(this._dataModel.mm(this.handleDataModelChange,this),this._dataModel.md(this.handleDataPropertyChange,this),this._dataModel.each(function(f){this.propagate(f)},this)):(this._dataModel.umm(this.handleDataModelChange,this),this._dataModel.umd(this.handleDataPropertyChange,this)))},handleDataModelChange:function(f){f.data&&this.propagate(f.data)},handleDataPropertyChange:function(f){var b;"alarmState"===f.property||"enablePropagation"===f.property?this.propagate(f.data):"parent"===f.property&&((b=f.oldValue)&&this.propagate(b),this.propagate(f.data))},propagate:function(f){f&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(f),this._isPropagating=!1)},propagateToTop:function(f){for(this.propagateToParent(null,f);f&&f.getParent();)this.propagateToParent(f,f.getParent()),f=f.getParent()},propagateToParent:function(f,b){var y=null;b.getChildren().each(function(f){f=f.getAlarmState().getHighestOverallAlarmSeverity();0<J.compare(f,y)&&(y=f)}),b.getAlarmState().setPropagateSeverity(y)}}),ht.AlarmStateStatistics=function(f){this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.dataMap={},this.setDataModel(f)},ht.Default.def("ht.AlarmStateStatistics",f,{ms_fire:1,getDataModel:function(){return this._dataModel},setDataModel:function(f){var b=this._dataModel;b!==f&&(b&&(b.umd(this.handleDataPropertyChange,this),b.umm(this.handleDataModelChange,this),this.severtiyMap={},this.dataMap={}),this._dataModel=f,this.reset(),f.md(this.handleDataPropertyChange,this),f.mm(this.handleDataModelChange,this),this.fp("dataModel",b,f))},dispose:function(){this._dataModel.umd(this.handleDataPropertyChange,this),this._dataModel.umm(this.handleDataModelChange,this),delete this._dataModel},handleDataPropertyChange:function(f){"alarmState"===f.property&&(this.increase(f.data),this.fireAlarmStateChange())},handleDataModelChange:function(f){"add"===f.kind?(this.increase(f.data),this.fireAlarmStateChange()):"remove"===f.kind?(this.decrease(f.data),this.fireAlarmStateChange()):"clear"===f.kind&&(this.severtiyMap={},this.dataMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,J.each(function(f){f=this.getSumInfo(f);this.sumAcked+=f.ackedCount,this.sumNew+=f.newCount,this.sumTotal+=f.totalCount},this),this.fp("alarmState",!1,!0)},getNewAlarmCount:function(f){return f?this.getSumInfo(f).newCount:this.sumNew},getAcknowledgedAlarmCount:function(f){return f?this.getSumInfo(f).ackedCount:this.sumAcked},getTotalAlarmCount:function(f){return f?this.getSumInfo(f).totalCount:this.sumTotal},getSumInfo:function(f){var b=this.severtiyMap[f.name];return b||(this.severtiyMap[f.name]=b={newCount:0,ackedCount:0,totalCount:0}),b},decrease:function(f){var y=this.dataMap[f.getId()];y&&(delete this.dataMap[f.getId()],J.each(function(f){var b=y[f.name],f=this.getSumInfo(f);f.newCount=f.newCount-b.newCount,f.ackedCount=f.ackedCount-b.ackedCount,f.totalCount=f.totalCount-b.totalCount},this))},increase:function(f){var y,x;this.decrease(f),this._filterFunc&&!this._filterFunc(f)||(y={},x=f.getAlarmState(),this.dataMap[f.getId()]=y,J.each(function(f){var b={},f=(b.newCount=x.getNewAlarmCount(f),b.ackedCount=x.getAcknowledgedAlarmCount(f),b.totalCount=x.getAlarmCount(f),y[f.name]=b,this.getSumInfo(f));f.newCount=f.newCount+b.newCount,f.ackedCount=f.ackedCount+b.ackedCount,f.totalCount=f.totalCount+b.totalCount},this))},reset:function(){this.severtiyMap={},this.dataMap={},this._dataModel.each(this.increase,this),this.fireAlarmStateChange()},setFilterFunc:function(f){var b=this._filterFunc;this._filterFunc=f,this.reset(),this.fp("filterFunc",b,f)},getFilterFunc:function(){return this._filterFunc}}),ht.Data.prototype),f=(f.getAlarmState=function(){return this._alarmState||(this._alarmState=new b(this))},(f=ht.DataModel.prototype).isEnableAlarmStatePropagator=function(){return!!this._alarmStatePropagator&&this._alarmStatePropagator.isEnable()},f.setEnableAlarmStatePropagator=function(f){f!=this.isEnableAlarmStatePropagator()&&(f?(this._alarmStatePropagator=new y(this)).setEnable(!0):this._alarmStatePropagator.setEnable(!1))},(f=ht.graph.GraphView.prototype).getNote2=function(f){var b=f.getAlarmState().getHighestNewAlarmSeverity();return b?(b=f.getAlarmState().getNewAlarmCount(b)+b.nickName,f.getAlarmState().hasLessSevereNewAlarms()&&(b+="+"),b):f.s("note2")},f.getNote2Background=function(f){var b=f.getAlarmState().getHighestNewAlarmSeverity();return b?b.color:f.s("note2.background")},f.getBodyColor=function(f){var b=f.getAlarmState().getHighestNativeAlarmSeverity();return b?b.color:f.s("body.color")},f.getBorderColor=function(f){var b=f.getAlarmState().getPropagateSeverity();return b?b.color:f.s("border.color")},(f=ht.widget.TreeView.prototype).getBorderColor=function(f){var b=f.getAlarmState().getPropagateSeverity();return b?b.color:f.s("border.color")},f.getIcon=function(f){return f.getIcon()?"__alarmIcon__":null},(f=ht.widget.TreeTableView.prototype).getBorderColor=function(f){var b=f.getAlarmState().getPropagateSeverity();return b?b.color:f.s("border.color")},f.getIcon=function(f){return f.getIcon()?"__alarmIcon__":null},ht.Default.setImage("__alarmIcon__",{width:16,height:16,comps:[{type:"image",name:{func:function(f){return f.getIcon()}},color:{func:function(f){var b=f.getAlarmState().getHighestNativeAlarmSeverity();return b?b.color:f.s("body.color")}},rect:[0,0,16,16]}]}),ht.Style);f["note2.expanded"]=!0,f["note2.color"]="#000"}(("undefined"==typeof global&&"undefined"==typeof self&&"undefined"==typeof window&&(0,eval)("this"),Object));