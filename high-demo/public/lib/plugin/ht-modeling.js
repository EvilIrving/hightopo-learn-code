!function(a,v){"use strict";function f(a,f,J){h("ht."+a,f,J)}function k(a,f,J){J?a.push(f.x,f.y):a.push(f.x,f.y,f.z)}function n(A,a,f){var J,j=A.data.getAttaches();if(j&&j.each(function(a){a instanceof F&&a.s("attach.operation")&&(J=J||[]).push(a)}),J){P.forEach(function(a){a=function(a,f,J,j){var o,U,Z,q,X=0,v=[];if(j)for(o=j.length;X<o;X+=3)U=j[X],Z=j[X+1],q=j[X+2],Y(v,new M([f[3*U],f[3*U+1],f[3*U+2]],null,J?[J[2*U],J[2*U+1],0]:S),new M([f[3*Z],f[3*Z+1],f[3*Z+2]],null,J?[J[2*Z],J[2*Z+1],0]:S),new M([f[3*q],f[3*q+1],f[3*q+2]],null,J?[J[2*q],J[2*q+1],0]:S),a);else for(o=f.length/3;X<o;X+=3)Z=(U=X)+1,q=X+2,Y(v,new M([f[3*U],f[3*U+1],f[3*U+2]],null,J?[J[2*U],J[2*U+1],0]:S),new M([f[3*Z],f[3*Z+1],f[3*Z+2]],null,J?[J[2*Z],J[2*Z+1],0]:S),new M([f[3*q],f[3*q+1],f[3*q+2]],null,J?[J[2*q],J[2*q+1],0]:S),a);return v}(a,A[a].vs,A[a].tuv);o=o?o.concat(a):a}),o=B.$15n(o),J.forEach(function(a){var f=a.s("attach.operation");o[f]&&(o=o[f](function(a,f,J){var j,o=g(a),U=[],Z=(a.appendAnchorMatrix3d(o),f?f.getData3dUI(a):null);if(Z&&Z.s("shape3d")&&!Z.s("csg.cull.box")&&(j=Z.shapeModel,j=Z.shapeModel?j:Q.getShapeModel(Z,Z.s("shape3d"))))for(var q=Q.createNormalMatrix(o),X=0,v=XD.length;X<v;X++){var A=(C=XD[X]).length?C+"_":C,I=j[A+"vs"],k=j[A+"uv"],O=j[A+"is"],K=j[A+"ns"];if(I&&I.length)for(var E,H,V,N=0,R=O?O.length:I.length/3;N<R;N+=3)V=O?(E=O[N],H=O[N+1],O[N+2]):(H=(E=N)+1,N+2),Y(U,new M(D([I[3*E],I[3*E+1],I[3*E+2]],o),K?D([K[3*E],K[3*E+1],K[3*E+2]],q):null,[k[2*E],k[2*E+1],0]),new M(D([I[3*H],I[3*H+1],I[3*H+2]],o),K?D([K[3*H],K[3*H+1],K[3*H+2]],q):null,[k[2*H],k[2*H+1],0]),new M(D([I[3*V],I[3*V+1],I[3*V+2]],o),K?D([K[3*V],K[3*V+1],K[3*V+2]],q):null,[k[2*V],k[2*V+1],0]),a)}if(!j)for(X=0;X<6;X++)for(var C=P[X],_=AD[X],k=J?f.getFaceUv(a,C):S,r=J?f.getFaceUvScale(a,C):S,p=J?f.getFaceUvOffset(a,C):S,F=0;F<2;F++){var m,n,e,u=i[_+3*F],c=i[_+3*F+1],x=i[_+3*F+2];J&&(e=k?(m=[k[2*u-(e=8*X)],k[2*u+1-e],0],n=[k[2*c-e],k[2*c+1-e],0],[k[2*x-e],k[2*x+1-e],0]):(m=[G[2*u],G[2*u+1],0],n=[G[2*c],G[2*c+1],0],[G[2*x],G[2*x+1],0]),r&&(m[0]*=r[0],m[1]*=r[1],n[0]*=r[0],n[1]*=r[1],e[0]*=r[0],e[1]*=r[1]),p&&(m[0]+=p[0],m[1]+=p[1],n[0]+=p[0],n[1]+=p[1],e[0]+=p[0],e[1]+=p[1])),Y(U,new M(D([w[3*u],w[3*u+1],w[3*u+2]],o),null,m),new M(D([w[3*c],w[3*c+1],w[3*c+2]],o),null,n),new M(D([w[3*x],w[3*x+1],w[3*x+2]],o),null,e),a)}return B.$15n(U)}(a,A.gv,A.csg.tuv)))}),P.forEach(function(a){(a=A[a]).vs=[],a.ns=[],a.tuv&&(a.tuv=[])}),A.csg&&!A.csg.ns&&(A.csg.ns=[]);var o,I=[];if(o.$19n().forEach(function(a){var f,J=a.$10n;if(J instanceof F){if(J.s("attach.cull"))return;f=(f=J.s("csg.cull.color"))&&Q.toColorArray(f),J="csg"}for(var J=A[J],j=J.vs,o=J.ns,U=J.tuv,Z=a.$9n,q=2;q<Z.length;q++)if(k(j,Z[0].$24n),k(j,Z[q-1].$24n),k(j,Z[q].$24n),o&&(k(o,Z[0].$22n),k(o,Z[q-1].$22n),k(o,Z[q].$22n)),U&&(k(U,Z[0].uv,!0),k(U,Z[q-1].uv,!0),k(U,Z[q].uv,!0)),f)for(var X=j.length/3*4,v=0;v<3;v++)I[--X]=f[3],I[--X]=f[2],I[--X]=f[1],I[--X]=f[0]}),I.length){for(var U=Q.toColorArray(A.csg.color),Z=0,q=A.csg.vs.length/3*4;Z<q;Z+=4)I[Z]==v&&(I[Z]=U[0],I[Z+1]=U[1],I[Z+2]=U[2],I[Z+3]=U[3]);A.csg.cs=I}}vD.forEach(function(a){var f=A[a];f.visible&&f.vs.length?(f.ns&&f.ns.length?O(f,"ns"):f.ns=z(f.vs),O(f,"vs"),O(f,"tuv"),f.cs&&O(f,"cs")):delete A[a]}),a&&(s(A,S,a,S,f),A.clear())}function j(a,f){this.$22n=a,this.w=f}function e(a,f,J,j,k){var o=[],U=[],Z=[],q=new R;if((a=a.getData3dUI(f)).mat){var X,A=(new C).fromArray(a.mat),f=new C,I=(f.makeRotationFromEuler(j),f.setPosition(J),(new C).getInverse(f)),v=(new C).scale({x:1/k.x,y:1/k.y,z:1/k.z}),O=[],K=new R,E=new R;for(a.eachShapeModel(function(a,f,J,j,o){for(var U,Z,q,X=0,v=f?f.length:a.length/3;X<v;X++)f?(K.fromArray(a,3*f[X]),E.fromArray(J,3*f[X])):(K.fromArray(a,3*X),E.fromArray(J,3*X)),o&&(K.applyMatrix4(o),E.transformDirection(o)),U=O,q=E,(Z=K).applyMatrix4(A),Z.applyMatrix4(I),q.transformDirection(A),q.transformDirection(I),U.push(new VD(Z.clone(),q.clone()))}),O=V(O,q.set(1,0,0)),O=V(O,q.set(-1,0,0)),O=V(O,q.set(0,1,0)),O=V(O,q.set(0,-1,0)),O=V(O,q.set(0,0,1)),O=V(O,q.set(0,0,-1)),X=0;X<O.length;X++){var H=O[X];Z.push(.5+H.position.x/k.x,.5-H.position.y/k.y),H.position.applyMatrix4(v),o.push(H.position.x,H.position.y,H.position.z),U.push(H.$22n.x,H.$22n.y,H.$22n.z)}return{vs:o,ns:U,uv:Z}}function V(a,f){for(var J=[],j=.5*Math.abs(k.dot(f)),o=0;o<a.length;o+=3){var U,Z,q,X,v=0<a[o+0].position.dot(f)-j,A=0<a[o+1].position.dot(f)-j,I=0<a[o+2].position.dot(f)-j;switch((v?1:0)+(A?1:0)+(I?1:0)){case 0:J.push(a[o]),J.push(a[o+1]),J.push(a[o+2]);break;case 1:if(v&&(U=a[o+1],Z=a[o+2],q=N(a[o],U,f,j),X=N(a[o],Z,f,j)),A){U=a[o],Z=a[o+2],q=N(a[o+1],U,f,j),X=N(a[o+1],Z,f,j),J.push(q),J.push(Z.clone()),J.push(U.clone()),J.push(Z.clone()),J.push(q.clone()),J.push(X);break}I&&(U=a[o],Z=a[o+1],q=N(a[o+2],U,f,j),X=N(a[o+2],Z,f,j)),J.push(U.clone()),J.push(Z.clone()),J.push(q),J.push(X),J.push(q.clone()),J.push(Z.clone());break;case 2:v||(Z=N(U=a[o].clone(),a[o+1],f,j),q=N(U,a[o+2],f,j),J.push(U),J.push(Z),J.push(q)),A||(Z=N(U=a[o+1].clone(),a[o+2],f,j),q=N(U,a[o],f,j),J.push(U),J.push(Z),J.push(q)),I||(Z=N(U=a[o+2].clone(),a[o],f,j),q=N(U,a[o+1],f,j),J.push(U),J.push(Z),J.push(q))}}return J}function N(a,f,J,j){var o=a.position.dot(J)-j,o=o/(o-(f.position.dot(J)-j));return new VD(new R(a.position.x+o*(f.position.x-a.position.x),a.position.y+o*(f.position.y-a.position.y),a.position.z+o*(f.position.z-a.position.z)),new R(a.$22n.x+o*(f.$22n.x-a.$22n.x),a.$22n.y+o*(f.$22n.y-a.$22n.y),a.$22n.z+o*(f.$22n.z-a.$22n.z)))}}var Z,q,X,A=a.ht,S=null,a=Math,H=a.PI,u=a.cos,V=a.sin,c=a.abs,x=a.max,l=a.sqrt,W=1e-5,U=A.Default,h=U.def,y=U.startAnim,t=U.createMatrix,D=U.transformVec,Q=U.getInternal(),J=Q.addMethod,o=Q.superCall,d=Q.toPointsArray,z=Q.createNormals,O=Q.toFloatArray,b=Q.glMV,a=(Q.glPop,A.graph3d.Graph3dView,A.Math),R=a.Vector3,C=a.Matrix4,T=a.Euler,s=(a.Quaternion,Q.batchShape),g=Q.createNodeMatrix,L=Q.getFaceInfo,$=Q.transformAppend,aD=Q.drawFaceInfo,fD=Q.createAnim,a=Q.cube(),i=a.is,w=a.vs,G=a.uv,a=Q.ui(),JD=A.Node,jD=A.Shape,oD="left",UD="right",ZD="top",qD="bottom",I="dw.expanded",K=".expanded",E="dw.angle",N=".angle",Y=(Z=new A.Math.Vector3,q=new A.Math.Vector3,X=new A.Math.Vector3,function(a,f,J,j,o){var U;Z.copy(f.$24n),q.copy(J.$24n),X.copy(j.$24n),X.equals(Z)||q.equals(Z)||q.equals(X)||(f.$22n&&J.$22n&&j.$22n||(U=q.sub(Z).cross(X.sub(Z)).normalize().multiplyScalar(1).toArray(),f.$22n||(f.$22n=new _(U)),J.$22n||(J.$22n=new _(U)),j.$22n||(j.$22n=new _(U))),a.push(new r([f,J,j],o)))}),P=[oD,"front",UD,"back",ZD,qD],XD=["",ZD,qD],vD=P.concat("csg"),AD=[0,6,12,18,24,30],B=(J(U,{createFrameModel:function(a,f,J,j){a=a==S?.07:a,f=f==S?a:f,J=J==S?a:J;var o=(j=j||{}).top,U=j.bottom,Z=j.left,q=j.right,X=j.front,j=j.back,v=[],A=[];return!0===X?(v.push(-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5),A.push(0,0,0,1,1,1,1,1,1,0,0,0)):!1!==X&&(v.push(-.5,.5,.5,-.5,-.5,.5,-.5+a,-.5,.5,-.5+a,-.5,.5,-.5+a,.5,.5,-.5,.5,.5,.5-a,.5,.5,.5-a,-.5,.5,.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5-a,.5,.5,-.5+a,.5,.5,-.5+a,.5-f,.5,.5-a,.5-f,.5,.5-a,.5-f,.5,.5-a,.5,.5,-.5+a,.5,.5,-.5+a,-.5+f,.5,-.5+a,-.5,.5,.5-a,-.5,.5,.5-a,-.5,.5,.5-a,-.5+f,.5,-.5+a,-.5+f,.5),A.push(0,0,0,1,a,1,a,1,a,0,0,0,1-a,0,1-a,1,1,1,1,1,1,0,1-a,0,a,0,a,f,1-a,f,1-a,f,1-a,0,a,0,a,1-f,a,1,1-a,1,1-a,1,1-a,1-f,a,1-f)),!0===j?(v.push(-.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5),A.push(1,0,0,1,1,1,0,1,1,0,0,0)):!1!==j&&(v.push(-.5,.5,-.5,-.5+a,-.5,-.5,-.5,-.5,-.5,-.5+a,-.5,-.5,-.5,.5,-.5,-.5+a,.5,-.5,.5-a,.5,-.5,.5,-.5,-.5,.5-a,-.5,-.5,.5,-.5,-.5,.5-a,.5,-.5,.5,.5,-.5,-.5+a,.5,-.5,.5-a,.5-f,-.5,-.5+a,.5-f,-.5,.5-a,.5-f,-.5,-.5+a,.5,-.5,.5-a,.5,-.5,-.5+a,-.5+f,-.5,.5-a,-.5,-.5,-.5+a,-.5,-.5,.5-a,-.5,-.5,-.5+a,-.5+f,-.5,.5-a,-.5+f,-.5),A.push(1,0,1-a,1,1,1,1-a,1,1,0,1-a,0,a,0,0,1,a,1,0,1,a,0,0,0,1-a,0,a,f,1-a,f,a,f,1-a,0,a,0,1-a,1-f,a,1,1-a,1,a,1,1-a,1-f,a,1-f)),!0===Z?(v.push(-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5),A.push(0,0,0,1,1,1,1,1,1,0,0,0)):!1!==Z&&(v.push(-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5+J,-.5,-.5,-.5+J,-.5,.5,-.5+J,-.5,.5,-.5,-.5,.5,.5-J,-.5,-.5,.5-J,-.5,-.5,.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,.5-J,-.5,.5,-.5+J,-.5,.5-f,-.5+J,-.5,.5-f,.5-J,-.5,.5-f,.5-J,-.5,.5,.5-J,-.5,.5,-.5+J,-.5,-.5+f,-.5+J,-.5,-.5,-.5+J,-.5,-.5,.5-J,-.5,-.5,.5-J,-.5,-.5+f,.5-J,-.5,-.5+f,-.5+J),A.push(0,0,0,1,J,1,J,1,J,0,0,0,1-J,0,1-J,1,1,1,1,1,1,0,1-J,0,J,0,J,f,1-J,f,1-J,f,1-J,0,J,0,J,1-f,J,1,1-J,1,1-J,1,1-J,1-f,J,1-f)),!0===q?(v.push(.5,.5,-.5,.5,-.5,.5,.5,-.5,-.5,.5,-.5,.5,.5,.5,-.5,.5,.5,.5),A.push(1,0,0,1,1,1,0,1,1,0,0,0)):!1!==q&&(v.push(.5,.5,-.5,.5,-.5,-.5+J,.5,-.5,-.5,.5,-.5,-.5+J,.5,.5,-.5,.5,.5,-.5+J,.5,.5,.5-J,.5,-.5,.5,.5,-.5,.5-J,.5,-.5,.5,.5,.5,.5-J,.5,.5,.5,.5,.5,-.5+J,.5,.5-f,.5-J,.5,.5-f,-.5+J,.5,.5-f,.5-J,.5,.5,-.5+J,.5,.5,.5-J,.5,-.5+f,-.5+J,.5,-.5,.5-J,.5,-.5,-.5+J,.5,-.5,.5-J,.5,-.5+f,-.5+J,.5,-.5+f,.5-J),A.push(1,0,1-J,1,1,1,1-J,1,1,0,1-J,0,J,0,0,1,J,1,0,1,J,0,0,0,1-J,0,J,f,1-J,f,J,f,1-J,0,J,0,1-J,1-f,J,1,1-J,1,J,1,1-J,1-f,J,1-f)),!0===o?(v.push(.5,.5,.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,.5),A.push(1,1,1,0,0,0,0,0,0,1,1,1)):!1!==o&&(v.push(.5,.5,.5,.5,.5,-.5,.5-a,.5,-.5,.5-a,.5,-.5,.5-a,.5,.5,.5,.5,.5,-.5+a,.5,.5,-.5+a,.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5+a,.5,.5,.5-a,.5,.5,.5-a,.5,.5-J,-.5+a,.5,.5-J,-.5+a,.5,.5-J,-.5+a,.5,.5,.5-a,.5,.5,.5-a,.5,-.5+J,.5-a,.5,-.5,-.5+a,.5,-.5,-.5+a,.5,-.5,-.5+a,.5,-.5+J,.5-a,.5,-.5+J),A.push(1,1,1,0,1-a,0,1-a,0,1-a,1,1,1,a,1,a,0,0,0,0,0,0,1,a,1,1-a,1,1-a,1-J,a,1-J,a,1-J,a,1,1-a,1,1-a,J,1-a,0,a,0,a,0,a,J,1-a,J)),!0===U?(v.push(.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5),A.push(1,0,0,1,1,1,0,1,1,0,0,0)):!1!==U&&(v.push(.5,-.5,.5,.5-a,-.5,-.5,.5,-.5,-.5,.5-a,-.5,-.5,.5,-.5,.5,.5-a,-.5,.5,-.5+a,-.5,.5,-.5,-.5,-.5,-.5+a,-.5,-.5,-.5,-.5,-.5,-.5+a,-.5,.5,-.5,-.5,.5,.5-a,-.5,.5,-.5+a,-.5,.5-J,.5-a,-.5,.5-J,-.5+a,-.5,.5-J,.5-a,-.5,.5,-.5+a,-.5,.5,.5-a,-.5,-.5+J,-.5+a,-.5,-.5,.5-a,-.5,-.5,-.5+a,-.5,-.5,.5-a,-.5,-.5+J,-.5+a,-.5,-.5+J),A.push(1,0,1-a,1,1,1,1-a,1,1,0,1-a,0,a,0,0,1,a,1,0,1,a,0,0,0,1-a,0,a,J,1-a,J,a,J,1-a,0,a,0,1-a,1-J,a,1,1-a,1,a,1,1-a,1-J,a,1-J)),{vs:v,uv:A}}}),J(A.Style,{"csg.cull.color":v,"csg.cull.box":!0,"dw.flip":!1,"dw.s3":[.999,.999,.5],"dw.t3":v,"dw.expanded":!1,"dw.toggleable":!0,"dw.axis":"left","dw.start":0,"dw.end":H/2,"dw.angle":0,"attach.cull":!1,"attach.operation":"subtract"},!0),P.forEach(function(a){var f={};f[a+K]=!1,f[a+".toggleable"]=!1,f[a+".axis"]=oD,f[a+".start"]=0,f[a+".end"]=H/2,f[a+N]=0,J(A.Style,f,!0)}),function(){this.$4n=[]}),_=(B.$15n=function(a){var f=new B;return f.$4n=a,f},B.prototype={clone:function(){var a=new B;return a.$4n=this.$4n.map(function(a){return a.clone()}),a},$19n:function(){return this.$4n},union:function(a){var f=new p(this.clone().$4n),a=new p(a.clone().$4n);return f.$3n(a),a.$3n(f),a.$6n(),a.$3n(f),a.$6n(),f.$7n(a.$2n()),B.$15n(f.$2n())},subtract:function(a){var f=new p(this.clone().$4n),a=new p(a.clone().$4n);return f.$6n(),f.$3n(a),a.$3n(f),a.$6n(),a.$3n(f),a.$6n(),f.$7n(a.$2n()),f.$6n(),B.$15n(f.$2n())},intersect:function(a){var f=new p(this.clone().$4n),a=new p(a.clone().$4n);return f.$6n(),a.$3n(f),a.$6n(),f.$3n(a),a.$3n(f),f.$7n(a.$2n()),f.$6n(),B.$15n(f.$2n())},inverse:function(){var a=this.clone();return a.$4n.map(function(a){a.flip()}),a}},B.cube=function(a){var J=new _((a=a||{}).center||[0,0,0]),j=a.radius?a.radius.length?a.radius:[a.radius,a.radius,a.radius]:[1,1,1];return B.$15n([[[0,4,6,2],[-1,0,0]],[[1,3,7,5],[1,0,0]],[[0,1,5,4],[0,-1,0]],[[2,6,7,3],[0,1,0]],[[0,2,3,1],[0,0,-1]],[[4,5,7,6],[0,0,1]]].map(function(f){return new r(f[0].map(function(a){a=new _(J.x+j[0]*(2*!!(1&a)-1),J.y+j[1]*(2*!!(2&a)-1),J.z+j[2]*(2*!!(4&a)-1));return new M(a,new _(f[1]))}))}))},B.sphere=function(a){var J,j=new _((a=a||{}).center||[0,0,0]),o=a.radius||1,f=a.slices||16,U=a.stacks||8,Z=[];function q(a,f){f*=H;a=new _(u(a*=2*H)*V(f),u(f),V(a)*V(f));J.push(new M(j.$20n(a.$21n(o)),a))}for(var X=0;X<f;X++)for(var v=0;v<U;v++)J=[],q(X/f,v/U),0<v&&q((X+1)/f,v/U),v<U-1&&q((X+1)/f,(v+1)/U),q(X/f,(v+1)/U),Z.push(new r(J));return B.$15n(Z)},B.cylinder=function(a){var j=new _((a=a||{}).start||[0,-1,0]),f=new _(a.end||[0,1,0]),o=f.$13n(j),U=a.radius||1,J=a.slices||16,Z=o.$14n(),a=.5<c(Z.y),q=new _(a,!a,0).cross(Z).$14n(),X=q.cross(Z).$14n(),v=new M(j,Z.$11n()),A=new M(f,Z.$14n()),I=[];function k(a,f,J){f=f*H*2,f=q.$21n(u(f)).$20n(X.$21n(V(f))),a=j.$20n(o.$21n(a)).$20n(f.$21n(U)),f=f.$21n(1-c(J)).$20n(Z.$21n(J));return new M(a,f)}for(var O=0;O<J;O++){var K=O/J,E=(O+1)/J;I.push(new r([v,k(0,K,-1),k(0,E,-1)])),I.push(new r([k(0,E,0),k(0,K,0),k(1,K,0),k(1,E,0)])),I.push(new r([A,k(1,E,1),k(1,K,1)]))}return B.$15n(I)},function(a,f,J){var j=this;3==arguments.length?(j.x=a,j.y=f,j.z=J):"x"in a?(j.x=a.x,j.y=a.y,j.z=a.z):(j.x=a[0],j.y=a[1],j.z=a[2])}),M=(_.prototype={clone:function(){return new _(this.x,this.y,this.z)},$11n:function(){return new _(-this.x,-this.y,-this.z)},$20n:function(a){return new _(this.x+a.x,this.y+a.y,this.z+a.z)},$13n:function(a){return new _(this.x-a.x,this.y-a.y,this.z-a.z)},$21n:function(a){return new _(this.x*a,this.y*a,this.z*a)},$16n:function(a){return new _(this.x/a,this.y/a,this.z/a)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lerp:function(a,f){return this.$20n(a.$13n(this).$21n(f))},length:function(){return l(this.dot(this))},$14n:function(){return this.$16n(this.length())},cross:function(a){var f=this;return new _(f.y*a.z-f.z*a.y,f.z*a.x-f.x*a.z,f.x*a.y-f.y*a.x)}},function(a,f,J){this.$24n=new _(a),this.$22n=f?new _(f):null,this.uv=J?new _(J):null}),r=(M.prototype={clone:function(){return new M(this.$24n.clone(),this.$22n.clone(),this.uv?this.uv.clone():null)},flip:function(){this.$22n=this.$22n.$11n()},$18n:function(a,f){return new M(this.$24n.lerp(a.$24n,f),this.$22n.lerp(a.$22n,f),this.uv?this.uv.lerp(a.uv,f):null)}},j.$17n=function(a,f,J){f=f.$13n(a).cross(J.$13n(a)).$14n();return new j(f,f.dot(a))},j.prototype={clone:function(){return new j(this.$22n.clone(),this.w)},flip:function(){this.$22n=this.$22n.$11n(),this.w=-this.w},$5n:function(a,f,J,j,o){for(var U=this,Z=0,q=[],X=0;X<a.$9n.length;X++){var v=(k=U.$22n.dot(a.$9n[X].$24n)-U.w)<-W?2:W<k?1:0;Z|=v,q.push(v)}switch(Z){case 0:(0<U.$22n.dot(a.$8n.$22n)?f:J).push(a);break;case 1:j.push(a);break;case 2:o.push(a);break;case 3:for(var A=[],I=[],X=0;X<a.$9n.length;X++){var k,O=(X+1)%a.$9n.length,K=q[X],E=q[O],H=a.$9n[X],O=a.$9n[O];2!=K&&A.push(H),1!=K&&I.push(2!=K?H.clone():H),3==(K|E)&&(k=(U.w-this.$22n.dot(H.$24n))/U.$22n.dot(O.$24n.$13n(H.$24n)),K=H.$18n(O,k),A.push(K),I.push(K.clone()))}3<=A.length&&j.push(new r(A,a.$10n)),3<=I.length&&o.push(new r(I,a.$10n))}}},function(a,f){this.$9n=a,this.$10n=f,this.$8n=j.$17n(a[0].$24n,a[1].$24n,a[2].$24n)}),p=(r.prototype={clone:function(){var a=this.$9n.map(function(a){return a.clone()});return new r(a,this.$10n)},flip:function(){this.$9n.reverse().map(function(a){a.flip()}),this.$8n.flip()}},function(a){var f=this;f.$8n=null,f.front=null,f.back=null,f.$4n=[],a&&f.$7n(a)}),ID=(p.prototype={clone:function(){var a=this,f=new p;return f.$8n=a.$8n&&a.$8n.clone(),f.front=a.front&&a.front.clone(),f.back=a.back&&a.back.clone(),f.$4n=a.$4n.map(function(a){return a.clone()}),f},$6n:function(){for(var a=this,f=0;f<a.$4n.length;f++)a.$4n[f].flip();a.$8n&&a.$8n.flip(),a.front&&a.front.$6n(),a.back&&a.back.$6n();var J=a.front;a.front=a.back,a.back=J},$1n:function(a){var f=this;if(!f.$8n)return a.slice();for(var J=[],j=[],o=0;o<a.length;o++)f.$8n.$5n(a[o],J,j,J,j);return f.front&&(J=f.front.$1n(J)),j=f.back?f.back.$1n(j):[],J.concat(j)},$3n:function(a){var f=this;f.$4n=a.$1n(f.$4n),f.front&&f.front.$3n(a),f.back&&f.back.$3n(a)},$2n:function(){var a=this,f=a.$4n.slice();return a.front&&(f=f.concat(a.front.$2n())),f=a.back?f.concat(a.back.$2n()):f},$7n:function(a){var f=this;if(a.length){f.$8n||(f.$8n=a[0].$8n.clone());for(var J=[],j=[],o=0;o<a.length;o++)this.$8n.$5n(a[o],f.$4n,f.$4n,J,j);J.length&&(f.front||(f.front=new p),this.front.$7n(J)),j.length&&(f.back||(f.back=new p),f.back.$7n(j))}}},A.Symbol=function(a,f,J){o(ID,this),this.s3(20,20,20),this.s({"all.visible":!1,shape:"rect"}),this.setIcon(a,f,J)}),F=(f("Symbol",JD,{setIcon:function(a,f,J){var j,o=this;return ID.superClass.setIcon.call(o,a),a?(j={for3d:!0,face:"center",position:44,names:[a]},J&&(j.transaprent=!0),f&&(j.autorotate=f),o.addStyleIcon("symbol",j)):o.removeStyleIcon("symbol"),o.setWidth(Q.getImageWidth(U.getImage(a),o)||20),j}}),A.CSGNode=function(){o(F,this),this.s({shape:"rect","attach.thickness":1.001,"2d.attachable":!0})}),kD={position:1,width:1,height:1,rotation:1,rotationX:1,rotationZ:1,rotationMode:1,tall:1,elevation:1,anchor:1,anchorElevation:1,"s:attach.cull":1,"s:attach.operation":1},m=(f("CSGNode",JD,{get3dUIClass:function(){return m},onPropertyChanged:function(a){var f=this.getHost();F.superClass.onPropertyChanged.call(this,a),kD[a.property]&&(f instanceof OD||f instanceof F)&&f.fp("csgNodeChange",!0,!1)}}),function(a,f){o(m,this,[a,f])}),OD=(h(m,a.Node3dUI,{drawBody:function(f,J,j){var o=this;o._shape3d?m.superClass.drawBody.call(o,f,J,j):(b(o.gv),vD.forEach(function(a){aD(o,f,J,a,j)}))},validate:function(a,f){var J=this,j=J.gv,o=J.data;if(o.s("shape3d"))return m.superClass.validate.call(J,a,f),void(J._shape3d=!0);J._shape3d=!1;var U=g(o,j.getMat(o)),Z=(o.appendAnchorMatrix3d(U),a&&a.uv);J.vf2("csg",Z);for(var q=0;q<6;q++)for(var X=P[q],v=AD[q],X=J.vf2(X,Z,f),A=X.mat||U,I=X.vs,k=X.uv,O=X.tuv,K=0;K<2;K++){var E,H=i[v+3*K],V=i[v+3*K+1],N=i[v+3*K+2];$(I,A,[w[3*H],w[3*H+1],w[3*H+2]]),$(I,A,[w[3*V],w[3*V+1],w[3*V+2]]),$(I,A,[w[3*N],w[3*N+1],w[3*N+2]]),O&&(k?O.push(k[2*H-(E=8*q)],k[2*H+1-E],k[2*V-E],k[2*V+1-E],k[2*N-E],k[2*N+1-E]):O.push(G[2*H],G[2*H+1],G[2*V],G[2*V+1],G[2*N],G[2*N+1]))}n(J,a,f)},vf2:function(a,f,J){var j=this.gv.getFaceVisible(this.data,a),a=L(this,a,J);return a.vs=[],a.tuv=j&&(a.texture||f)?[]:S,a.visible=j,a}}),A.CSGShape=function(){var a=this;o(OD,a),a.s({"shape.background":S,"2d.hostable":!0,"shape.border.width":8}),a.setTall(240),a.setElevation(120),a.setThickness(14)}),KD=(f("CSGShape",jD,{IRotatable:!1,get3dUIClass:function(){return KD},setRotationX:function(a){},setRotation:function(a){},setRotationZ:function(a){},setSegments:function(a){}}),function(a,f){o(KD,this,[a,f])}),ED=(h(KD,a.Shape3dUI,{drawBody:function(f,J,j){var o=this;o.undrawable||(b(o.gv),vD.forEach(function(a){aD(o,f,J,a,j)}))},validate:function(f,J){var a,j,o,U,Z=this,q=Z.data,X=q.getPoints();(Z.undrawable=X.size()<2)?Z.clear():(a=q.isClosePath(),j=x(q._thickness/2,W),X=d(X,S,S,a),vD.forEach(function(a){Z.vf(a,f&&f.uv,!0,J)}),a&&(Z.left.visible=!1,Z.right.visible=!1),Z._12O(X,j),Z._20Q(X),o=q.getPointsMatrix3d(),U=A.Math.requestVector3(),P.forEach(function(a){if(Z[a])for(var f=Z[a].vs,J=0,j=f.length;J<j;J+=3)U.set(f[J],f[J+1],f[J+2]).applyMatrix4(o),f[J]=U.x,f[J+1]=U.y,f[J+2]=U.z}),A.Math.releaseVector3(U),n(Z,f,J))}}),A.DoorWindow=function(){o(ED,this),this.setElevation(100),this.s3(100,200,14)}),HD=(f("DoorWindow",F,{IDoorWindow:!0,toggle:function(a){this.setExpanded(!this.s(I),a)},isExpanded:function(){return this.s(I)},setExpanded:function(a,f){var J,j=this,o=j.$25n,U=j.s(I);o&&(o.stop(!0),delete j.$25n),U!==a&&(j.beginTransaction(),J=a?j.s("dw.end"):j.s("dw.start"),j.s(I,a),(f=fD(f))?(U=j.s(E),f.action=function(a){j.s(E,U+(J-U)*a)},f.finishFunc=function(){j.endTransaction()},j.$25n=y(f)):(j.s(E,J),j.endTransaction()))},getMat:function(){var a,f,J=this,j=J.s("dw.s3"),o=J.s("dw.t3"),U=J.s("dw.flip"),Z=J.s(E);return j||Z||o||U?(a=[],U&&a.push({r3:[0,H,0]}),j&&a.push({s3:j}),Z&&(j=J.getFinalScale3d(),U=J.s("dw.axis"),J=j[0]/2,f=j[1]/2,j[2],U===oD?a.push({t3:[J,0,0]},{r3:[0,-Z,0]},{t3:[-J,0,0]}):U===UD?a.push({t3:[-J,0,0]},{r3:[0,Z,0]},{t3:[J,0,0]}):U===ZD?a.push({t3:[0,-f,0]},{r3:[-Z,0,0]},{t3:[0,f,0]}):U===qD?a.push({t3:[0,f,0]},{r3:[Z,0,0]},{t3:[0,-f,0]}):"v"===U?a.push({r3:[0,Z,0]}):"h"===U&&a.push({r3:[Z,0,0]})),o&&a.push({t3:o}),t(a)):S}}),A.CSGBox=function(){o(HD,this),this.setElevation(100),this.s3(100,200,100)});f("CSGBox",F,{ICSGBox:!0,toggleFace:function(a,f){this.setFaceExpanded(a,!this.s(a+K),f)},isFaceExpanded:function(a){return this.s(a+K)},setFaceExpanded:function(f,a,J){var j,o=this,U=o.$25n,Z=o.s(f+K);U&&(U.stop(!0),delete o.$25n),Z!==a&&(j=a?o.s(f+".end"):o.s(f+".start"),o.s(f+K,a),(J=fD(J))?(Z=o.s(f+N),J.action=function(a){o.s(f+N,Z+(j-Z)*a)},o.$25n=y(J)):o.s(f+N,j))},getFaceMat:function(a){var f=this.s(a+N);if(!f)return S;var J,j,o,U,Z,q,X=this.s(a+".axis"),v=this.getFinalScale3d(),A=this.getAnchor3d(),I=v[0]*A.x,k=v[1]*A.y,O=v[2]*A.z,K=v[0]-I,E=v[1]-k,H=v[2]-O;switch(a+"_"+X){case"front_left":J=-I,o=H,Z=-f,q=U=j=0;break;case"front_right":J=K,o=H,Z=f,q=U=j=0;break;case"front_top":j=E,o=H,U=-f,q=Z=J=0;break;case"front_bottom":j=-k,o=H,U=f,q=Z=J=0;break;case"front_h":o=H,U=f,q=Z=j=J=0;break;case"front_v":o=H,Z=f,q=U=j=J=0;break;case"back_left":J=K,o=-O,Z=-f,q=U=j=0;break;case"back_right":J=-I,o=-O,Z=f,q=U=j=0;break;case"back_top":j=E,o=-O,U=f,q=Z=J=0;break;case"back_bottom":j=-k,o=-O,U=-f,q=Z=J=0;break;case"back_h":o=-O,U=f,q=Z=j=J=0;break;case"back_v":o=-O,Z=f,q=U=j=J=0;break;case"left_left":J=-I,o=-O,Z=-f,q=U=j=0;break;case"left_right":J=-I,o=H,Z=f,q=U=j=0;break;case"left_top":J=-I,j=E,Z=U=o=0,q=-f;break;case"left_bottom":J=-I,j=-k,Z=U=o=0,q=f;break;case"left_h":J=-I,Z=U=o=j=0,q=f;break;case"left_v":J=-I,Z=f,q=U=o=j=0;break;case"right_left":J=K,o=H,Z=-f,q=U=j=0;break;case"right_right":J=K,o=-O,Z=f,q=U=j=0;break;case"right_top":J=K,j=E,Z=U=o=0,q=f;break;case"right_bottom":J=K,j=-k,Z=U=o=0,q=-f;break;case"right_h":J=K,Z=U=o=j=0,q=f;break;case"right_v":J=K,Z=f,q=U=o=j=0;break;case"top_left":J=-I,j=E,Z=U=o=0,q=f;break;case"top_right":J=K,j=E,Z=U=o=0,q=-f;break;case"top_top":j=E,o=-O,U=-f,q=Z=J=0;break;case"top_bottom":j=E,o=H,U=f,q=Z=J=0;break;case"top_h":j=E,U=f,q=Z=o=J=0;break;case"top_v":j=E,Z=U=o=J=0,q=f;break;case"bottom_left":J=-I,j=-k,Z=U=o=0,q=-f;break;case"bottom_right":J=K,j=-k,Z=U=o=0,q=f;break;case"bottom_top":j=-k,o=H,U=-f,q=Z=J=0;break;case"bottom_bottom":j=-k,o=-O,U=f,q=Z=J=0;break;case"bottom_h":j=-k,U=f,q=Z=o=J=0;break;case"bottom_v":j=-k,Z=U=o=J=0,q=f}return t([{t3:[-J,-j,-o]},{r3:[U,Z,q]},{t3:[J,j,o]}])}});function VD(a,f){this.position=a,this.$22n=f}VD.prototype.clone=function(){return new VD(this.position.clone(),this.$22n.clone())};J(A.graph3d.Graph3dView,{createDecal:function(a,f,J,j){var o=this,U=o.getDataAt(a);if(U){var Z,q,X,a=o.intersectObject(a,U);if(a)return f="object"==typeof f?f.x?new R(f.x,f.y,f.z):new R(f[0],f[1],f[2]):new R(f=f||20,f,f),J=J===v?.1:J,X=new R(o.getUp()),Z=(q=new R(o.getCenter()).sub(new R(o.getEye())).normalize()).clone().cross(X).normalize(),X.copy(Z).cross(q).normalize(),j&&X.applyAxisAngle(a.worldNormal,-j),Z=new A.Node,q=a.worldNormal.clone().setLength(J).add(a.world),j=(new C).lookAt(a.worldNormal.clone(),new R(0,0,0),X),J=(new T).setFromRotationMatrix(j),X=e(o,U,a.world.clone(),J,f),Z.p3(q.x,q.y,q.z),Z.setEuler(J),Z.s3(f.x,f.y,f.z),Z.s({shape3d:X,"shape3d.reverse.flip":!0}),Z}}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),void Object);