!function(e){"use strict";var D=e.ht,V=D.Default,F=V.getInternal(),v=F.superCall,e=D.graph3d.Graph3dView,M=e.prototype.validateImpl;function w(G){var k,m,u,p,i,r=[],Z=0,Q=V.createDiv(!0),v=G.getView(),M=(v.insertBefore(Q,G.getCanvas()),(k=D.Default.createDiv()).style.WebkitTransformStyle="preserve-3d",k.style.MozTransformStyle="preserve-3d",k.style.transformStyle="preserve-3d",Q.appendChild(k),[{event:"mousedown",style:"none"},{event:"mouseup",style:"auto"},{event:"touchstart",style:"none"},{event:"touchend",style:"auto"}].forEach(function(e){var D=e.style;F.addEventListener(v,e.event,function(){G.isDragProtectForWebView()&&(Q.style.pointerEvents=D)})}),this.updateWebView=function(){if(G.getWidth()&&G.getHeight()){for(var e,D=G.getCanvas(),v=+D.style.width.slice(0,-2),D=+D.style.height.slice(0,-2),v=(r[0]===v&&r[1]===D||(r[0]=v,r[1]=D,Q.style.width=v+"px",Q.style.height=D+"px",k.style.width=v+"px",k.style.height=D+"px"),G._projectMatrix[5]*r[1]/2),v=(v!==m&&(m=v,Q.style.WebkitPerspective=m+"px",Q.style.MozPerspective=m+"px",Q.style.perspective=m+"px"),(i="translateZ("+m+"px)"+("matrix3d("+O((D=G._viewMatrix)[0])+","+O(-D[1])+","+O(D[2])+","+O(D[3])+","+O(D[4])+","+O(-D[5])+","+O(D[6])+","+O(D[7])+","+O(D[8])+","+O(-D[9])+","+O(D[10])+","+O(D[11])+","+O(D[12])+","+O(-D[13])+","+O(D[14])+","+O(D[15])+")"))+"translate("+r[0]/2+"px,"+r[1]/2+"px)"),F=(u===v||p||(k.style.WebkitTransform=v,k.style.MozTransform=v,k.style.transform=v,u=v),Z++,G.dm().each(function(e){e.isWebView&&$(e)}),k.children),M=[],V=0,w=F.length;V<w;V++)(e=F[V])._isHtWebView&&e._renderCookie!==Z&&M.push(e);M.length&&M.forEach(function(e){k.removeChild(e)})}},new Array(16)),$=function(e){var D,v,F=e.getAttach();F&&((v=G.isVisible(e))&&F.parentNode!==k?k.appendChild(F):!v&&F.parentNode&&V.removeHTML(F),v&&(F._renderCookie=Z,v=e.getFinalScale3d(),(D=e._prefrenceSize)&&D[0]?D[1]||(D[1]=D[0]/v[0]*v[1]):D=[v[0],v[1]],F.style.width=D[0]+"px",F.style.height=D[1]+"px",v=1/D[0],D=1/D[1],e=e.mat,M[0]=e[0]*v,M[1]=e[1]*v,M[2]=e[2]*v,M[3]=e[3]*v,M[4]=e[4]*D,M[5]=e[5]*D,M[6]=e[6]*D,M[7]=e[7]*D,M[8]=+e[8],M[9]=+e[9],M[10]=+e[10],M[11]=+e[11],M[12]=e[12],M[13]=e[13],M[14]=e[14],M[15]=e[15],v=function(e,D){e="matrix3d("+O(e[0])+","+O(e[1])+","+O(e[2])+","+O(e[3])+","+O(-e[4])+","+O(-e[5])+","+O(-e[6])+","+O(-e[7])+","+O(e[8])+","+O(e[9])+","+O(e[10])+","+O(e[11])+","+O(e[12])+","+O(e[13])+","+O(e[14])+","+O(e[15])+")";return"translate(-50%,-50%)"+(D||"")+e}(M,p?"translate("+r[0]/2+"px,"+r[1]/2+"px)"+i:""),F.$a2!==v&&(F.$a2=v,F.style.WebkitTransform=v,F.style.MozTransform=v,F.style.transform=v)))}}function O(e){return Math.abs(e)<1e-10?0:e}e.prototype.validateImpl=function(){M.call(this),(this._webViewRenderer||(this._webViewRenderer=new w(this))).updateWebView()},e.prototype.isDragProtectForWebView=function(){return this._dragProtectForWebView},e.prototype.setDragProtectForWebView=function(e){this._dragProtectForWebView=e};var G=D.WebView3d=function(){v(G,this),this.s({shape3d:"billboard","shape3d.reverse.flip":!0})},k=[1,1,1,1],m=[0,0,0,0];V.def("ht.WebView3d",D.Node,{ms_ac:["attach"],isWebView:!0,attachDOM:function(e,D,v){if(!e)return this.detachDOM();"string"==typeof e&&((F=document.createElement("iframe")).src=e,e=F);var F=e.style;F.position="absolute",F.outline=0,F.margin=0,e._isHtWebView=!0,this.setAttach(e),this._prefrenceSize=[D,v],this.s("shape3d.blend",m)},detachDOM:function(){this.setAttach(null),this.s("shape3d.blend",this.getBgColor())},setBgColor:function(e){this.a("defaultBgColor",e),this.getAttach()||this.s("shape3d.blend",e)},getBgColor:function(){return this.a("defaultBgColor")||k}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);