!function(J,w,o){"use strict";var z,K,T=J.ht;T.Astar={};function y(J){for(var w=J,K=[];w.parent;)K.unshift(w),w=w.parent;return K}function i(J,w){w=w||{},this.nodes=[],this.diagonal=!!w.diagonal,this.grid=[];for(var K=0;K<J.length;K++){this.grid[K]=[];for(var o=0,i=J[K];o<i.length;o++){var H=new k(K,o,i[o]);this.grid[K][o]=H,this.nodes.push(H)}}this.$13x()}function k(J,w,K){this.x=J,this.y=w,this.weight=K}function Z(J){this.content=[],this.scoreFunction=J}z={search:function(J,w,K,o){J.$6x();var i=(i=(o=o||{}).heuristic)||(J.diagonal?z.$4x.diagonal:z.$4x.manhattan),H=o.closest||!1,k=o.punish,v=new Z(function(J){return J.f}),m=w;for(w.h=i(w,K),J.$7x(w),v.push(w);0<v.size();){var D=v.pop();if(D===K)return y(D);D.closed=!0;for(var b=J.neighbors(D),A=0,$=b.length;A<$;++A){var I,M,O=b[A];O.closed||O.$9x()||(I=D.g+O.getCost(D,k),(!(M=O.visited)||I<O.g)&&(O.visited=!0,O.parent=D,O.h=O.h||i(O,K),O.g=I,O.f=O.g+O.h,J.$7x(O),H&&(O.h<m.h||O.h===m.h&&O.g<m.g)&&(m=O),M?v.$10x(O):v.push(O)))}}return H?y(m):[]},$4x:{manhattan:function(J,w){return Math.abs(w.x-J.x)+Math.abs(w.y-J.y)},diagonal:function(J,w){var K=Math.sqrt(2),o=Math.abs(w.x-J.x),w=Math.abs(w.y-J.y);return+(o+w)+(K-2)*Math.min(o,w)}},$5x:function(J){J.f=0,J.g=0,J.h=0,J.visited=!1,J.closed=!1,J.parent=null}},i.prototype.$13x=function(){this.dirtyNodes=[];for(var J=0;J<this.nodes.length;J++)z.$5x(this.nodes[J])},i.prototype.$6x=function(){for(var J=0;J<this.dirtyNodes.length;J++)z.$5x(this.dirtyNodes[J]);this.dirtyNodes=[]},i.prototype.$7x=function(J){this.dirtyNodes.push(J)},i.prototype.neighbors=function(J){var w=[],K=J.x,J=J.y,o=this.grid;return o[K-1]&&o[K-1][J]&&w.push(o[K-1][J]),o[K+1]&&o[K+1][J]&&w.push(o[K+1][J]),o[K]&&o[K][J-1]&&w.push(o[K][J-1]),o[K]&&o[K][J+1]&&w.push(o[K][J+1]),this.diagonal&&(o[K-1]&&o[K-1][J-1]&&w.push(o[K-1][J-1]),o[K+1]&&o[K+1][J-1]&&w.push(o[K+1][J-1]),o[K-1]&&o[K-1][J+1]&&w.push(o[K-1][J+1]),o[K+1]&&o[K+1][J+1]&&w.push(o[K+1][J+1])),w},i.prototype.toString=function(){for(var J=[],w=this.grid,K=0;K<w.length;K++){for(var o=[],i=w[K],H=0;H<i.length;H++)o.push(i[H].weight);J.push(o.join(" "))}return J.join("\n")},k.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},k.prototype.getCost=function(J,w){var K=J&&J.x!=this.x&&J.y!=this.y?1.41421*this.weight:this.weight;if(w){if(!J)return K;var o=J.parent;if(!o)return K;if(1e-5<Math.abs(o.x+this.x-2*J.x))return K+w;if(1e-5<Math.abs(o.y+this.y-2*J.y))return K+w}return K},k.prototype.$9x=function(){return 0===this.weight},Z.prototype={push:function(J){this.content.push(J),this.$11x(this.content.length-1)},pop:function(){var J=this.content[0],w=this.content.pop();return 0<this.content.length&&(this.content[0]=w,this.$12x(0)),J},remove:function(J){var w=this.content.indexOf(J),K=this.content.pop();w!==this.content.length-1&&(this.content[w]=K,this.scoreFunction(K)<this.scoreFunction(J)?this.$11x(w):this.$12x(w))},size:function(){return this.content.length},$10x:function(J){this.$11x(this.content.indexOf(J))},$11x:function(J){for(var w=this.content[J];0<J;){var K=(J+1>>1)-1,o=this.content[K];if(!(this.scoreFunction(w)<this.scoreFunction(o)))break;this.content[K]=w,this.content[J]=o,J=K}},$12x:function(J){for(var w=this.content.length,K=this.content[J],o=this.scoreFunction(K);;){var i,H=J+1<<1,k=H-1,v=null;if(k<w&&(i=this.content[k],(i=this.scoreFunction(i))<o&&(v=k)),H<w&&(k=this.content[H],this.scoreFunction(k)<(null===v?o:i)&&(v=H)),null===v)break;this.content[J]=this.content[v],this.content[v]=K,J=v}}},K={astar:z,Graph:i},J.AStar=K.astar,J.AStar.Graph=K.Graph;J=T.Astar.Finder=function(J,w){this.gv=J,this.$13x(w),this.refreshMap()};(J.prototype={}).constructor=J,w.defineProperties(J.prototype,{_debugInfo:{get:function(){return this.gv._astarDebugInfo},set:function(J){this.gv._astarDebugInfo=J}}}),J.prototype.$13x=function(J){var w=this.$14x={},K=(J=J||{}).gridSize||10;w.gridSizeX=J.gridSizeX||K,w.gridSizeY=J.gridSizeY||K,w.rect=J.rect,w.filter=J.filter,w.extendBlocks=J.extendBlocks||3,w.fastOverlap=J.fastOverlap===o||J.fastOverlap,w.nodeRectExtend=J.nodeRectExtend||0,w.diagonal=J.diagonal===o||J.diagonal,w.turnPunish=J.turnPunish===o?.1:J.turnPunish,w.simplify=J.simplify===o||J.simplify,w.toGridCenter=J.toGridCenter!==o&&J.toGridCenter,w.closest=J.closest===o||J.closest},J.prototype.refreshMap=function(){var J=this,w=J.$14x,K=w.gridSizeX,o=w.gridSizeY,i=w.extendBlocks,w=(w.rect?k=w.rect:(k=J.$15x(),T.Default.grow(k,K*i,o*i)),T.Default.grow(k,K,o),Math.floor(k.x/K)*K),i=Math.floor(k.y/o)*o,H=Math.ceil(k.width/K),k=Math.ceil(k.height/o);J.$16x={x:w,y:i,w:H*K,h:k*o,gridX:K,gridY:o,xLen:H,yLen:k},J.$17x(),J.$21x()},J.prototype.$15x=function(){var w,K=this.gv;if(K instanceof T.graph.GraphView)return K.getContentRect();var o=T.Default.unionRect;return K.dm().each(function(J){K.isVisible(J)&&J.getRect&&(w=o(w,J.getRect()))}),w},J.prototype.$17x=function(){for(var J,w,K=this,o=K.$16x,i=o.xLen,H=o.yLen,k=new Array(i),v=0;v<i;v++)for(k[v]=J=new Array(H),w=H;w--;)J[w]=1;var m=K.$14x.filter;for(K.gv.dm().each(function(J){m&&!1===m(J)||K._debugInfo&&(J===K._debugInfo.grid||J==K._debugInfo.path)||K.$1cw(k,J)}),v=0;v<i;v++)k[v][0]=1,k[v][H-1]=1;for(w=0;w<H;w++)k[0][w]=1,k[i-1][w]=1;K.grid=k;o=new AStar.Graph(k,{diagonal:K.$14x.diagonal});K.graph=o},J.prototype.$18x=function(J,w,K,o,i,H,k,v){var m=this.$19x,D=m(K-J,i-k,o-w,H-v);if(D<=1e-6&&-1e-6<=D)return!1;k=m(i-J,i-k,H-w,H-v)/D;if(k<0||1<k)return!1;v=m(K-J,i-J,o-w,H-w)/D;return!(v<0||1<v)},J.prototype.$19x=function(J,w,K,o){return J*o-w*K},J.prototype.$1aw=function(J,w,K,o){for(var i=[-(w[1]-J[1]),w[0]-J[0]],H=0<=i[0]*(K[0]-J[0])+i[1]*(K[1]-J[1]),k=0,v=o.length;k<v;k+=2)if(0<=i[0]*(o[k]-J[0])+i[1]*(o[k+1]-J[1])==H)return!1;return!0},J.prototype.$1bw=function(J,w){for(var K,o,i=0,H=J.length;i<H;i+=2)if(this.$1aw([J[i],J[i+1]],[J[K=i===H-2?0:i+2],J[K+1]],[J[o=K===H-2?0:K+2],J[o+1]],w))return!1;for(i=0,H=w.length;i<H;i+=2)if(this.$1aw([w[i],w[i+1]],[w[K=i===H-2?0:i+2],w[K+1]],[w[o=K===H-2?0:K+2],w[o+1]],J))return!1;return!0},J.prototype.$1cw=function(J,w){if(w.getRect){var K,o,i,H,k,v,m,D,b,A,$,I,M=this,O=w.getRect(),z=(T.Default.grow(O,M.$14x.nodeRectExtend),M.$1dw({x:O.x,y:O.y})),O=M.$1dw({x:O.x+O.width,y:O.y+O.height}),y=M.$14x.fastOverlap;for(y||(w=w.getCorners(),D=[],w.forEach(function(J){D.push(J.x,J.y)}),v=M.$14x.gridSizeX/2,m=M.$14x.gridSizeY/2),w=Math.max(0,z.x),o=Math.min(O.x,J.length-1),H=Math.max(0,z.y),k=Math.min(O.y,J.length?J[0].length-1:-1),K=w;K<=o;K++)for(i=H;i<=k;i++)y?J[K][i]=0:(b=(I=M.$1ew({x:K,y:i})).x-v,A=I.x+v,$=I.y-m,I=I.y+m,M.$1bw(D,[b,$,b,I,A,I,A,$])&&(J[K][i]=0))}},J.prototype.$1dw=function(J,w){var K=this.$16x,o=(J.x-K.x)/K.gridX,J=(J.y-K.y)/K.gridY;return!1!==w&&(o=Math.round(o),J=Math.round(J)),{x:o,y:J}},J.prototype.$1ew=function(J){var w=this.$16x;return{x:J.x*w.gridX+w.x,y:J.y*w.gridY+w.y}},J.prototype.$1fw=function(J){var w=this.$16x,K=w.xLen,w=w.yLen;if(0<=J.x&&J.x<K&&0<=J.y&&J.y<w)return J;J={x:J.x,y:J.y};return J.x<0?J.x=0:J.x>=K&&(J.x=K-1),J.y<0?J.y=0:J.y>=w&&(J.y=w-1),J},J.prototype.findPath=function(J,w){var K,o,i=this,H=i.$1dw(J),k=i.$1dw(w),v=i.$1fw(H),m=i.$1fw(k);if(v!==H&&m!==k){var D=i.$16x,b=D.x-D.gridX/2,A=D.y-D.gridY/2,$=b+D.gridX*D.xLen,D=A+D.gridY*D.yLen;if(!(i.$18x(J.x,J.y,w.x,w.y,b,A,$,A)||i.$18x(J.x,J.y,w.x,w.y,$,A,$,D)||i.$18x(J.x,J.y,w.x,w.y,$,D,b,D)||i.$18x(J.x,J.y,w.x,w.y,b,D,b,A)))return[J,w]}v!==H&&(K=!0,H=v),m!==k&&(o=!0,k=m);var $=i.graph.grid[H.x][H.y],D=i.graph.grid[k.x][k.y],I=AStar.search(i.graph,$,D,{closest:i.$14x.closest,punish:i.$14x.turnPunish});if(!I||!I.length)return null;var M=[];M.push(J),K&&M.push(i.$1ew(I[0]));for(var O=1,z=I.length;O<z-1;O++)M.push(i.$1ew(I[O]));return o?(M.push(i.$1ew(I[z-1])),M.push(w)):(b=I[z-1],k.x!==b.x||k.y!==b.y||i.$14x.toGridCenter?M.push(i.$1ew(b)):M.push(w)),i.$14x.simplify&&(M=i.simplifyPath(M)),i.$20x=M,i.$21x(),M},J.prototype.debugOn=function(J){this.debugFlag=!0,this.debugSettings=J||{},this.$21x()},J.prototype.simplifyPath=function(J){var w=J.length;if(w<=2)return J;for(var K,o=[J[0],J[1]],i=o[0],H=o[1],k=2;k<w;k++)K=J[k],Math.abs((H.x-i.x)*(K.y-i.y)-(H.y-i.y)*(K.x-i.x))<1e-5?H=o[o.length-1]=K:(i=H,o.push(H=K));return o},J.prototype.$21x=function(){var J=this;if(J.$22x(),this.debugFlag){var w=J.grid;if(w){var K=J.gv;if(!1!==J.debugSettings.$16x){for(var o,i,H,k,v=[],m=[],D=J.$14x.gridSizeX/2,b=J.$14x.gridSizeY/2,A=w.length,$=A?w[0].length:0,I=1;I<A-1;I++)for(var M=1;M<$-1;M++)w[I][M]||(o=(k=J.$1ew({x:I,y:M})).x-D,i=k.x+D,H=k.y-b,k=k.y+b,v.push({x:o,y:H},{x:o,y:k},{x:i,y:k},{x:i,y:H}),m.push(1,2,2,2,5));var O=new T.Shape;O.s("shape.border.color","rgba(50, 50, 50, 0.2)"),O.s("shape.border.width",1),O.s("shape.background","rgba(200, 50, 100, 0.2)"),O.s("2d.editable",!1),O.s("2d.selectable",!1),O.setPoints(v),O.setSegments(m),J._debugInfo={grid:O},K.dm().add(O)}!1!==J.debugSettings.path&&(v=new T.Shape,J.$20x&&(v.setPoints(J.$20x),v.s("shape.border.color","red"),v.s("shape.border.width",1),v.s("2d.editable",!1),v.s("2d.selectable",!1),v.s("shape.background",null),J._debugInfo||(J._debugInfo={}),J._debugInfo.path=v,K.dm().add(v)))}}},J.prototype.debugOff=function(){this.debugFlag=!1,this.$22x()},J.prototype.$22x=function(){var J,w,K,o=this;o._debugInfo&&(J=o._debugInfo.grid,w=o._debugInfo.path,K=o.gv,J&&K.dm().remove(J),w&&K.dm().remove(w),o._debugInfo=null)}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);