!function(r){"use strict";var y=ht.AlarmSeverity=function(r,c,J,$,R){this.value=r,this.name=c,this.nickName=J,this.color=$,this.displayName=R},c=(ht.Default.def("ht.AlarmSeverity",r,{toString:function(){return this.displayName||this.name}}),y.severities=new ht.List,y._vm={},y._nm={},y._cp=function(r,c){var J;return r&&c?0<(J=r.value-c.value)?1:J<0?-1:0:r&&!c?1:!r&&c?-1:0},y.each=function(r,c){y.severities.each(r,c)},y.getSortFunction=function(){return y._cp},y.setSortFunction=function(r){y._cp=r,y.severities.sort(r)},y.add=function(r,c,J,$,R){J=new y(r,c,J,$,R);return y._vm[r]=J,y._nm[c]=J,y.severities.add(J),y.severities.sort(y._cp),J},y.remove=function(r){var c=y._nm[r];return c&&(delete y._nm[r],delete y._vm[c.value],y.severities.remove(c)),c},y.CRITICAL=y.add(500,"Critical","C","#FF0000"),y.MAJOR=y.add(400,"Major","M","#FFA000"),y.MINOR=y.add(300,"Minor","m","#FFFF00"),y.WARNING=y.add(200,"Warning","W","#00FFFF"),y.INDETERMINATE=y.add(100,"Indeterminate","N","#C800FF"),y.CLEARED=y.add(0,"Cleared","R","#00FF00"),y.isClearedAlarmSeverity=function(r){return!!r&&0===r.value},y.getByName=function(r){return y._nm[r]},y.getByValue=function(r){return y._vm[r]},y.clear=function(){y.severities.clear(),y._vm={},y._nm={}},y.compare=function(r,c){return y._cp(r,c)},ht.AlarmState=function(r){this._d=r,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0}),J=(ht.Default.def("ht.AlarmState",r,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._d.fp("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var r,c=null;for(r in this._am)r=y.getByName(r),y.isClearedAlarmSeverity(r)||0!==this.getAcknowledgedAlarmCount(r)&&(c=c&&0<y.compare(c,r)?c:r);this._haa=c},_c2:function(){var r,c=null;for(r in this._nm)r=y.getByName(r),y.isClearedAlarmSeverity(r)||0!==this.getNewAlarmCount(r)&&(c=c&&0<y.compare(c,r)?c:r);this._hna=c},_c3:function(){if(this._hna){for(var r in this._nm)if(r=y.getByName(r),!y.isClearedAlarmSeverity(r)&&0!==this.getNewAlarmCount(r)&&0<y.compare(this._hna,r))return void(this._hls=!0);this._hls=!1}else this._hls=!1},_c4:function(){var r=this._haa,c=this._hna,J=this._ps;this._hoa=r,0<y.compare(c,this._hoa)&&(this._hoa=c),0<y.compare(J,this._hoa)&&(this._hoa=J)},_c5:function(){var r=this._haa,c=this._hna;this._hta=r,0<y.compare(c,this._hta)&&(this._hta=c)},increaseAcknowledgedAlarm:function(r,c){var J;0!==c&&(J=this._am[r.name]||0,this._am[r.name]=J+=c=c||1,this._f())},increaseNewAlarm:function(r,c){var J;0!==c&&(J=this._nm[r.name]||0,this._nm[r.name]=J+=c=c||1,this._f())},decreaseAcknowledgedAlarm:function(r,c){if(0!==c){var J=this._am[r.name]||0;if((J-=c=c||1)<0)throw"Alarm count can not be negative";this._am[r.name]=J,this._f()}},decreaseNewAlarm:function(r,c){if(0!==c){var J=this._nm[r.name]||0;if((J-=c=c||1)<0)throw"Alarm count can not be negative";this._nm[r.name]=J,this._f()}},acknowledgeAlarm:function(r){this.decreaseNewAlarm(r,1),this.increaseAcknowledgedAlarm(r,1)},acknowledgeAllAlarms:function(r){if(r){var c=this.getNewAlarmCount(r);this.decreaseNewAlarm(r,c),this.increaseAcknowledgedAlarm(r,c)}else for(var J in this._nm)this.acknowledgeAllAlarms(y.getByName(J))},_c6:function(){for(var r in this._aac=0,this._am)r=y.getByName(r),this._aac+=this.getAcknowledgedAlarmCount(r)},getAcknowledgedAlarmCount:function(r){return r?this._am[r.name]||0:this._aac},getAlarmCount:function(r){return this.getAcknowledgedAlarmCount(r)+this.getNewAlarmCount(r)},_c7:function(){for(var r in this._nac=0,this._nm)this._nac+=this.getNewAlarmCount(y.getByName(r))},getNewAlarmCount:function(r){return r?this._nm[r.name]||0:this._nac},setNewAlarmCount:function(r,c){this._nm[r.name]=c,this._f()},removeAllNewAlarms:function(r){r?delete this._nm[r]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(r,c){this._am[r.name]=c,this._f()},removeAllAcknowledgedAlarms:function(r){r?delete this._am[r.name]:this._am={},this._f()},isEmpty:function(){return!this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(r){var c;this._ep||(r=null),this._ps!==r&&(c=this._ps,this._ps=r,this._f(),this._d.fp("propagateSeverity",c,r))},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(r){var c=this._ep;this._ep=r,this._d.fp("enablePropagation",c,r)&&!r&&this.setPropagateSeverity(null)}}),ht.AlarmStatePropagator=function(r){this._dataModel=r,this._enable=!1,this._isPropagating=!1}),r=(ht.Default.def("ht.AlarmStatePropagator",r,{getDataModel:function(){return this._dataModel},isEnable:function(){return this._enable},setEnable:function(r){this._enable!==r&&(this._enable=r,this._enable?(this._dataModel.mm(this.handleDataModelChange,this),this._dataModel.md(this.handleDataPropertyChange,this),this._dataModel.each(function(r){this.propagate(r)},this)):(this._dataModel.umm(this.handleDataModelChange,this),this._dataModel.umd(this.handleDataPropertyChange,this)))},handleDataModelChange:function(r){r.data&&this.propagate(r.data)},handleDataPropertyChange:function(r){var c;"alarmState"===r.property||"enablePropagation"===r.property?this.propagate(r.data):"parent"===r.property&&((c=r.oldValue)&&this.propagate(c),this.propagate(r.data))},propagate:function(r){r&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(r),this._isPropagating=!1)},propagateToTop:function(r){for(this.propagateToParent(null,r);r&&r.getParent();)this.propagateToParent(r,r.getParent()),r=r.getParent()},propagateToParent:function(r,c){var J=null;c.getChildren().each(function(r){r=r.getAlarmState().getHighestOverallAlarmSeverity();0<y.compare(r,J)&&(J=r)}),c.getAlarmState().setPropagateSeverity(J)}}),ht.AlarmStateStatistics=function(r){this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.dataMap={},this.setDataModel(r)},ht.Default.def("ht.AlarmStateStatistics",r,{ms_fire:1,getDataModel:function(){return this._dataModel},setDataModel:function(r){var c=this._dataModel;c!==r&&(c&&(c.umd(this.handleDataPropertyChange,this),c.umm(this.handleDataModelChange,this),this.severtiyMap={},this.dataMap={}),this._dataModel=r,this.reset(),r.md(this.handleDataPropertyChange,this),r.mm(this.handleDataModelChange,this),this.fp("dataModel",c,r))},dispose:function(){this._dataModel.umd(this.handleDataPropertyChange,this),this._dataModel.umm(this.handleDataModelChange,this),delete this._dataModel},handleDataPropertyChange:function(r){"alarmState"===r.property&&(this.increase(r.data),this.fireAlarmStateChange())},handleDataModelChange:function(r){"add"===r.kind?(this.increase(r.data),this.fireAlarmStateChange()):"remove"===r.kind?(this.decrease(r.data),this.fireAlarmStateChange()):"clear"===r.kind&&(this.severtiyMap={},this.dataMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,y.each(function(r){r=this.getSumInfo(r);this.sumAcked+=r.ackedCount,this.sumNew+=r.newCount,this.sumTotal+=r.totalCount},this),this.fp("alarmState",!1,!0)},getNewAlarmCount:function(r){return r?this.getSumInfo(r).newCount:this.sumNew},getAcknowledgedAlarmCount:function(r){return r?this.getSumInfo(r).ackedCount:this.sumAcked},getTotalAlarmCount:function(r){return r?this.getSumInfo(r).totalCount:this.sumTotal},getSumInfo:function(r){var c=this.severtiyMap[r.name];return c||(this.severtiyMap[r.name]=c={newCount:0,ackedCount:0,totalCount:0}),c},decrease:function(r){var J=this.dataMap[r.getId()];J&&(delete this.dataMap[r.getId()],y.each(function(r){var c=J[r.name],r=this.getSumInfo(r);r.newCount=r.newCount-c.newCount,r.ackedCount=r.ackedCount-c.ackedCount,r.totalCount=r.totalCount-c.totalCount},this))},increase:function(r){var J,$;this.decrease(r),this._filterFunc&&!this._filterFunc(r)||(J={},$=r.getAlarmState(),this.dataMap[r.getId()]=J,y.each(function(r){var c={},r=(c.newCount=$.getNewAlarmCount(r),c.ackedCount=$.getAcknowledgedAlarmCount(r),c.totalCount=$.getAlarmCount(r),J[r.name]=c,this.getSumInfo(r));r.newCount=r.newCount+c.newCount,r.ackedCount=r.ackedCount+c.ackedCount,r.totalCount=r.totalCount+c.totalCount},this))},reset:function(){this.severtiyMap={},this.dataMap={},this._dataModel.each(this.increase,this),this.fireAlarmStateChange()},setFilterFunc:function(r){var c=this._filterFunc;this._filterFunc=r,this.reset(),this.fp("filterFunc",c,r)},getFilterFunc:function(){return this._filterFunc}}),ht.Data.prototype),r=(r.getAlarmState=function(){return this._alarmState||(this._alarmState=new c(this))},(r=ht.DataModel.prototype).isEnableAlarmStatePropagator=function(){return!!this._alarmStatePropagator&&this._alarmStatePropagator.isEnable()},r.setEnableAlarmStatePropagator=function(r){r!=this.isEnableAlarmStatePropagator()&&(r?(this._alarmStatePropagator=new J(this)).setEnable(!0):this._alarmStatePropagator.setEnable(!1))},(r=ht.graph.GraphView.prototype).getNote2=function(r){var c=r.getAlarmState().getHighestNewAlarmSeverity();return c?(c=r.getAlarmState().getNewAlarmCount(c)+c.nickName,r.getAlarmState().hasLessSevereNewAlarms()&&(c+="+"),c):r.s("note2")},r.getNote2Background=function(r){var c=r.getAlarmState().getHighestNewAlarmSeverity();return c?c.color:r.s("note2.background")},r.getBodyColor=function(r){var c=r.getAlarmState().getHighestNativeAlarmSeverity();return c?c.color:r.s("body.color")},r.getBorderColor=function(r){var c=r.getAlarmState().getPropagateSeverity();return c?c.color:r.s("border.color")},(r=ht.widget.TreeView.prototype).getBorderColor=function(r){var c=r.getAlarmState().getPropagateSeverity();return c?c.color:r.s("border.color")},r.getIcon=function(r){return r.getIcon()?"__alarmIcon__":null},(r=ht.widget.TreeTableView.prototype).getBorderColor=function(r){var c=r.getAlarmState().getPropagateSeverity();return c?c.color:r.s("border.color")},r.getIcon=function(r){return r.getIcon()?"__alarmIcon__":null},ht.Default.setImage("__alarmIcon__",{width:16,height:16,comps:[{type:"image",name:{func:function(r){return r.getIcon()}},color:{func:function(r){var c=r.getAlarmState().getHighestNativeAlarmSeverity();return c?c.color:r.s("body.color")}},rect:[0,0,16,16]}]}),ht.Style);r["note2.expanded"]=!0,r["note2.color"]="#000"}(("undefined"==typeof global&&"undefined"==typeof self&&"undefined"==typeof window&&(0,eval)("this"),Object));